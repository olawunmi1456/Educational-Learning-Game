<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Educational Games Platform - Upload and Play HTML5 Games">
    <title>EducationalGamez.com | Upload & Play Games</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Base Styles & Variables */
        :root {
            --primary: #4a6fa5;
            --secondary: #6b8cbc;
            --accent: #ff9e5d;
            --light: #f0f5ff;
            --dark: #2c3e50;
            --success: #5cb85c;
            --danger: #d9534f;
            --warning: #f0ad4e;
            --radius: 12px;
            --shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --max-width: 1400px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Skip to main content for accessibility */
        .skip-to-content {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--accent);
            color: white;
            padding: 8px 16px;
            z-index: 1001;
            text-decoration: none;
            border-radius: 0 0 var(--radius) 0;
            transition: var(--transition);
        }
        
        .skip-to-content:focus {
            top: 0;
        }
        
        /* Header & Navigation */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 5%;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: var(--max-width);
            margin: 0 auto;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: white;
        }
        
        .logo i {
            font-size: 2rem;
            color: var(--accent);
        }
        
        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        /* Navigation */
        nav {
            position: relative;
        }
        
        .nav-list {
            display: flex;
            list-style: none;
            gap: 1.5rem;
            margin: 0;
            padding: 0;
        }
        
        .nav-list a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            transition: var(--transition);
            padding: 0.5rem 0.8rem;
            border-radius: var(--radius);
            display: block;
        }
        
        .nav-list a:hover,
        .nav-list a:focus {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            outline: 2px solid white;
        }
        
        .nav-list a.active {
            background-color: rgba(255, 255, 255, 0.25);
        }
        
        .auth-buttons {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }
        
        .btn {
            padding: 0.6rem 1.2rem;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
        }
        
        .btn-primary {
            background-color: var(--accent);
            color: white;
        }
        
        .btn-primary:hover,
        .btn-primary:focus {
            background-color: #ff8e42;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 158, 93, 0.4);
            outline: none;
        }
        
        .btn-secondary {
            background-color: transparent;
            color: white;
            border: 2px solid white;
        }
        
        .btn-secondary:hover,
        .btn-secondary:focus {
            background-color: white;
            color: var(--primary);
            outline: none;
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius);
        }
        
        .mobile-menu-btn:hover,
        .mobile-menu-btn:focus {
            background-color: rgba(255, 255, 255, 0.1);
            outline: 2px solid white;
        }
        
        /* Hero Section */
        .hero {
            padding: 3rem 5%;
            background: linear-gradient(rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.9)), 
                        url('https://images.unsplash.com/photo-1516321318423-f06f85e504b3?ixlib=rb-4.0.3&auto=format&fit=crop&w=1170&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        
        .hero-container {
            max-width: var(--max-width);
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            align-items: center;
        }
        
        .hero-content h2 {
            font-size: 2.5rem;
            color: var(--dark);
            margin-bottom: 1rem;
            line-height: 1.2;
        }
        
        .hero-content p {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            color: #555;
        }
        
        .hero-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .hero-image {
            background-color: var(--primary);
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
            transform: perspective(1000px) rotateY(-5deg);
            transition: var(--transition);
        }
        
        .hero-image:hover {
            transform: perspective(1000px) rotateY(0deg) scale(1.02);
        }
        
        .game-preview {
            background-color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .educational-game-image-container {
            width: 100%;
            max-width: 400px;
            height: 250px;
            margin-bottom: 1.5rem;
            border-radius: var(--radius);
            overflow: hidden;
            border: 2px solid var(--light);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .educational-game-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }
        
        .educational-game-image:hover {
            transform: scale(1.05);
        }
        
        .educational-game-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        .educational-game-placeholder i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--accent);
        }
        
        /* Games Library Section */
        .games-library {
            padding: 4rem 5%;
            background-color: white;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .section-title h2 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .section-title p {
            color: #666;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .library-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .search-box {
            position: relative;
            flex-grow: 1;
            max-width: 400px;
        }
        
        .search-box input {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 2.5rem;
            border: 2px solid #ddd;
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.1);
        }
        
        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
        }
        
        .filter-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 0.5rem 1rem;
            background-color: white;
            border: 2px solid var(--light);
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .filter-btn:hover,
        .filter-btn:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        .filter-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .game-card {
            background-color: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            border: 1px solid #eee;
        }
        
        .game-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.12);
        }
        
        .game-card.uploaded {
            border-left: 5px solid var(--success);
        }
        
        .game-image {
            height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            position: relative;
        }
        
        .game-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .game-type-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--accent);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .game-info {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .game-info h3 {
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-size: 1.2rem;
        }
        
        .game-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            color: #777;
            font-size: 0.9rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .game-desc {
            margin-bottom: 1.5rem;
            color: #555;
            font-size: 0.95rem;
            flex-grow: 1;
        }
        
        .game-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .play-btn {
            flex-grow: 1;
            padding: 0.7rem;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .play-btn:hover,
        .play-btn:focus {
            background-color: var(--secondary);
            outline: none;
        }
        
        .delete-btn {
            padding: 0.7rem;
            background-color: var(--light);
            color: var(--danger);
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
        }
        
        .delete-btn:hover,
        .delete-btn:focus {
            background-color: var(--danger);
            color: white;
            outline: none;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #777;
        }
        
        .empty-state i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 1rem;
        }
        
        /* Upload Section */
        .upload-section {
            padding: 4rem 5%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .upload-container {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }
        
        .upload-container h2 {
            font-size: 2.2rem;
            margin-bottom: 1rem;
        }
        
        .upload-container p {
            margin-bottom: 2rem;
            font-size: 1.1rem;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .upload-box {
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: var(--radius);
            padding: 3rem 2rem;
            margin-top: 2rem;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }
        
        .upload-box:hover,
        .upload-box.dragover {
            background-color: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .upload-box i {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            color: var(--accent);
        }
        
        .upload-formats {
            font-size: 0.9rem;
            margin-top: 1rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .upload-button-container {
            margin-top: 2rem;
        }
        
        .upload-button {
            font-size: 1rem;
            padding: 0.9rem 1.8rem;
        }
        
        #fileInput {
            display: none;
        }
        
        .upload-progress {
            margin-top: 1rem;
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--accent);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .upload-details {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-top: 2rem;
            text-align: left;
            display: none;
        }
        
        .upload-details h3 {
            margin-bottom: 1rem;
            color: var(--accent);
        }
        
        .file-list {
            list-style: none;
            margin-bottom: 1.5rem;
        }
        
        .file-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .file-list li:last-child {
            border-bottom: none;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .file-size {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius);
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(255, 158, 93, 0.2);
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        /* Game Player Modal */
        .game-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .game-modal.active {
            display: flex;
            opacity: 1;
        }
        
        .modal-content {
            background-color: white;
            border-radius: var(--radius);
            width: 100%;
            max-width: 1200px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        
        .game-modal.active .modal-content {
            transform: scale(1);
        }
        
        .modal-header {
            padding: 1.2rem 1.5rem;
            background-color: var(--primary);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            transition: var(--transition);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .close-modal:hover,
        .close-modal:focus {
            background-color: rgba(255, 255, 255, 0.2);
            outline: none;
        }
        
        .game-frame {
            flex-grow: 1;
            border: none;
            min-height: 500px;
            width: 100%;
            background-color: #f5f5f5;
        }
        
        .modal-loader {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            flex-grow: 1;
        }
        
        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* Login/Signup Modal */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .auth-modal.active {
            display: flex;
            opacity: 1;
        }
        
        .auth-modal-content {
            background-color: white;
            border-radius: var(--radius);
            width: 100%;
            max-width: 450px;
            overflow: hidden;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        
        .auth-modal.active .auth-modal-content {
            transform: scale(1);
        }
        
        .auth-modal-header {
            padding: 1.5rem;
            background-color: var(--primary);
            color: white;
            text-align: center;
            position: relative;
        }
        
        .auth-modal-title {
            font-size: 1.5rem;
            margin: 0;
        }
        
        .auth-close-modal {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .auth-close-modal:hover,
        .auth-close-modal:focus {
            background-color: rgba(255, 255, 255, 0.2);
            outline: none;
        }
        
        .auth-modal-body {
            padding: 2rem;
        }
        
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .auth-form-group {
            position: relative;
        }
        
        .auth-form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .auth-form-group input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .auth-form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.1);
        }
        
        .password-toggle {
            position: absolute;
            right: 10px;
            top: 40px;
            background: none;
            border: none;
            color: #777;
            cursor: pointer;
            font-size: 1rem;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .password-toggle:hover,
        .password-toggle:focus {
            background-color: #f0f0f0;
            outline: none;
        }
        
        .auth-form-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }
        
        .auth-switch-text {
            font-size: 0.9rem;
            color: #666;
        }
        
        .auth-switch-link {
            color: var(--primary);
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            text-decoration: underline;
        }
        
        .auth-switch-link:hover,
        .auth-switch-link:focus {
            color: var(--secondary);
            outline: none;
        }
        
        .auth-error {
            color: var(--danger);
            font-size: 0.9rem;
            margin-top: 0.5rem;
            display: none;
        }
        
        .auth-error.show {
            display: block;
        }
        
        .user-menu {
            display: none;
            align-items: center;
            gap: 1rem;
        }
        
        .user-menu.active {
            display: flex;
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            background-color: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .user-name {
            font-weight: 600;
        }
        
        .logout-btn {
            padding: 0.5rem 1rem;
            background-color: transparent;
            color: white;
            border: 2px solid white;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }
        
        .logout-btn:hover,
        .logout-btn:focus {
            background-color: white;
            color: var(--primary);
            outline: none;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            color: white;
            font-weight: 600;
            z-index: 2001;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            box-shadow: var(--shadow);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: var(--success);
        }
        
        .notification.error {
            background-color: var(--danger);
        }
        
        .notification.warning {
            background-color: var(--warning);
        }
        
        /* Stats Container */
        .stats-container {
            margin-top: 3rem;
            display: flex;
            gap: 2rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            margin-bottom: 0.3rem;
            color: var(--accent);
        }
        
        /* Footer */
        footer {
            background-color: var(--dark);
            color: white;
            padding: 3rem 5% 1.5rem;
            margin-top: auto;
        }
        
        .footer-container {
            max-width: var(--max-width);
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .footer-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 1rem;
        }
        
        .footer-logo i {
            font-size: 1.8rem;
            color: var(--accent);
        }
        
        .footer-links h3,
        .footer-contact h3 {
            margin-bottom: 1.2rem;
            font-size: 1.2rem;
        }
        
        .footer-links ul {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 0.6rem;
        }
        
        .footer-links a {
            color: #ccc;
            text-decoration: none;
            transition: var(--transition);
        }
        
        .footer-links a:hover,
        .footer-links a:focus {
            color: var(--accent);
            padding-left: 5px;
            outline: none;
        }
        
        .footer-contact p {
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .social-link {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: white;
            text-decoration: none;
            transition: var(--transition);
        }
        
        .social-link:hover,
        .social-link:focus {
            background-color: var(--accent);
            transform: translateY(-3px);
            outline: none;
        }
        
        .copyright {
            text-align: center;
            padding-top: 1.5rem;
            border-top: 1px solid #444;
            color: #aaa;
            font-size: 0.9rem;
        }
        
        /* Welcome Modal */
        .welcome-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .welcome-modal.active {
            display: flex;
            opacity: 1;
        }
        
        .welcome-modal-content {
            background-color: white;
            border-radius: var(--radius);
            width: 100%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            transform: scale(0.95);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .welcome-modal.active .welcome-modal-content {
            transform: scale(1);
        }
        
        .welcome-modal-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            text-align: center;
            position: relative;
        }
        
        .welcome-modal-title {
            font-size: 1.8rem;
            margin: 0;
        }
        
        .welcome-close-modal {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .welcome-close-modal:hover,
        .welcome-close-modal:focus {
            background-color: rgba(255, 255, 255, 0.2);
            outline: none;
        }
        
        .welcome-modal-body {
            padding: 2rem;
            overflow-y: auto;
            flex-grow: 1;
        }
        
        .welcome-message {
            font-size: 1.1rem;
            line-height: 1.7;
            margin-bottom: 1.5rem;
        }
        
        .welcome-message p {
            margin-bottom: 1rem;
        }
        
        .welcome-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .welcome-feature {
            text-align: center;
            padding: 1.5rem;
            background-color: var(--light);
            border-radius: var(--radius);
            transition: var(--transition);
        }
        
        .welcome-feature:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }
        
        .welcome-feature i {
            font-size: 2.5rem;
            color: var(--accent);
            margin-bottom: 1rem;
        }
        
        .welcome-feature h4 {
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        /* Responsive Design */
        @media (max-width: 992px) {
            .hero-container {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 2rem;
            }
            
            .hero-image {
                order: -1;
                max-width: 500px;
                margin: 0 auto;
            }
            
            .hero-actions {
                justify-content: center;
            }
            
            .nav-list {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background-color: var(--primary);
                flex-direction: column;
                padding: 1rem;
                border-radius: 0 0 var(--radius) var(--radius);
                box-shadow: var(--shadow);
            }
            
            .nav-list.active {
                display: flex;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .hero-content h2 {
                font-size: 2rem;
            }
            
            .section-title h2 {
                font-size: 1.8rem;
            }
            
            .upload-container h2 {
                font-size: 1.8rem;
            }
            
            .upload-box {
                padding: 2rem 1rem;
            }
            
            .library-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                max-width: 100%;
            }
            
            .stats-container {
                gap: 1.5rem;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
            
            .hero-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .hero-actions .btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
            
            .welcome-features {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .header-container {
                flex-wrap: wrap;
                gap: 1rem;
            }
            
            .auth-buttons {
                order: 1;
                width: 100%;
                justify-content: center;
            }
            
            .games-grid {
                grid-template-columns: 1fr;
            }
            
            .game-actions {
                flex-direction: column;
            }
            
            .delete-btn {
                width: 100%;
            }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease forwards;
        }
        
        /* Focus styles for accessibility */
        :focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }
        
        /* Reduced motion preference */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Skip to main content for keyboard users -->
    <a href="#main-content" class="skip-to-content">Skip to main content</a>

    <!-- Header -->
    <header>
        <div class="header-container">
            <a href="#home" class="logo" id="homeLogo">
                <i class="fas fa-gamepad" aria-hidden="true"></i>
                <h1>Educational Games Platform</h1>
            </a>
            
            <nav aria-label="Main navigation">
                <button class="mobile-menu-btn" type="button" aria-label="Toggle navigation menu" aria-expanded="false">
                    <i class="fas fa-bars"></i>
                </button>
                
                <ul class="nav-list">
                    <li><a href="#home" class="active" id="homeLink">Home</a></li>
                    <li><a href="#library">Game Library</a></li>
                    <li><a href="#upload">Upload Game</a></li>
                    <li><a href="#about">About</a></li>
                </ul>
            </nav>
            
            <div class="auth-buttons">
                <button class="btn btn-secondary" id="loginBtn" aria-label="Login to your account">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <button class="btn btn-primary" id="signupBtn" aria-label="Create new account">
                    <i class="fas fa-user-plus"></i> Sign Up
                </button>
            </div>
            
            <!-- User Menu (shown when logged in) -->
            <div class="user-menu" id="userMenu">
                <div class="user-avatar" id="userAvatar"></div>
                <span class="user-name" id="userName"></span>
                <button class="logout-btn" id="logoutBtn" aria-label="Logout">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home" aria-labelledby="hero-title">
        <div class="hero-container">
            <div class="hero-content fade-in">
                <h2 id="hero-title">Upload & Play HTML5 Games</h2>
                <p>Upload your educational HTML5 games and play them directly in your browser. No downloads required! Share your creations with the world or enjoy games from other developers.</p>
                <div class="hero-actions">
                    <button class="btn btn-primary" id="browseGamesBtn">
                        <i class="fas fa-gamepad"></i> Browse Games
                    </button>
                    <button class="btn btn-secondary" id="uploadHeroBtn">
                        <i class="fas fa-upload"></i> Upload Game
                    </button>
                </div>
            </div>
            
            <div class="hero-image fade-in">
                <div class="game-preview">
                    <!-- Educational Game Image Container -->
                    <div class="educational-game-image-container">
                        <!-- Try to load the educational game image with fallback -->
                        <img src="educational-game-image.png" 
                             alt="Educational Game - Interactive learning experience" 
                             class="educational-game-image"
                             onerror="this.style.display='none'; document.getElementById('image-placeholder').style.display='flex';">
                        
                        <!-- Fallback placeholder if image doesn't load -->
                        <div class="educational-game-placeholder" id="image-placeholder">
                            <i class="fas fa-gamepad"></i>
                            <h3>Educational Game</h3>
                            <p>Interactive Learning Experience</p>
                        </div>
                    </div>
                    
                    <h3>Quick Upload Demo</h3>
                    <p>Try uploading the sample game below to see how it works!</p>
                    <div class="demo-buttons-container">
                        <button class="play-btn" onclick="scrollToUpload()" aria-label="Upload your game">
                            <i class="fas fa-upload"></i> Try Upload
                        </button>
                        <!-- NEW: Button to open mobile.spelling.html -->
                        <button class="play-btn" onclick="openMobileSpellingGame()" aria-label="Open Mobile Spelling Game">
                            <i class="fas fa-mobile-alt"></i> Open Mobile Spelling Game
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Games Library Section -->
    <section class="games-library" id="library" aria-labelledby="library-title">
        <div class="section-title">
            <h2 id="library-title">Game Library</h2>
            <p>Browse and play uploaded HTML5 games from our community</p>
        </div>
        
        <div class="library-controls">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="gameSearch" placeholder="Search games by title, category, or description...">
            </div>
            
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">All Games</button>
                <button class="filter-btn" data-filter="uploaded">My Games</button>
                <button class="filter-btn" data-filter="math">Math</button>
                <button class="filter-btn" data-filter="science">Science</button>
                <button class="filter-btn" data-filter="language">Language</button>
                <button class="filter-btn" data-filter="coding">Coding</button>
                <button class="filter-btn" data-filter="other">Others</button>
            </div>
        </div>
        
        <div class="games-grid" id="gamesGrid" tabindex="-1">
            <!-- Games will be loaded here dynamically -->
        </div>
        
        <div class="empty-state" id="emptyState">
            <i class="fas fa-gamepad"></i>
            <h3>No Games Found</h3>
            <p>Upload your first game to get started!</p>
            <button class="btn btn-primary" onclick="scrollToUpload()">
                <i class="fas fa-upload"></i> Upload Game
            </button>
        </div>
    </section>

    <!-- Upload Section -->
    <section class="upload-section" id="upload" aria-labelledby="upload-title">
        <div class="upload-container">
            <h2 id="upload-title">Upload Your HTML5 Game</h2>
            <p>Upload HTML5, JavaScript, or WebGL games. Your game will be playable directly in the browser after upload.</p>
            
            <div class="upload-box" id="uploadBox" role="button" tabindex="0" 
                 aria-label="Drag and drop area for game files. Click or press enter to select files.">
                <i class="fas fa-cloud-upload-alt"></i>
                <h3>Drag & Drop Your Game Files</h3>
                <p>Or click to browse files on your computer</p>
                <p class="upload-formats">Supported: HTML, JS, CSS, images (Max: 5MB total)</p>
                
                <input type="file" id="fileInput" multiple accept=".html,.js,.css,.png,.jpg,.jpeg,.gif">
                
                <div class="upload-progress" id="uploadProgress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <p id="progressText">Uploading... 0%</p>
                </div>
            </div>
            
            <div class="upload-details" id="uploadDetails">
                <h3>Game Details</h3>
                <ul class="file-list" id="fileList"></ul>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="gameTitle">Game Title *</label>
                        <input type="text" id="gameTitle" placeholder="Enter game title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="gameCategory">Category *</label>
                        <select id="gameCategory" required>
                            <option value="">Select category</option>
                            <option value="math">Mathematics</option>
                            <option value="science">Science</option>
                            <option value="language">Language Arts</option>
                            <option value="coding">Programming</option>
                            <option value="social">Social Studies</option>
                            <option value="arts">Arts & Creativity</option>
                            <option value="puzzle">Puzzle</option>
                            <option value="other">Others</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="gameDescription">Description *</label>
                    <textarea id="gameDescription" placeholder="Describe your game, learning objectives, and how to play..." required></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="gameAge">Age Range</label>
                        <input type="text" id="gameAge" placeholder="e.g., 8+, 12-16, All ages">
                    </div>
                    
                    <div class="form-group">
                        <label for="mainFile">Main HTML File *</label>
                        <select id="mainFile" required>
                            <option value="">Select main HTML file</option>
                        </select>
                    </div>
                </div>
                
                <div class="upload-button-container">
                    <button class="btn btn-success upload-button" id="saveGameBtn">
                        <i class="fas fa-save"></i> Save & Publish Game
                    </button>
                    <button class="btn btn-secondary" id="cancelUploadBtn">
                        Cancel
                    </button>
                </div>
            </div>
            
            <div class="stats-container">
                <div class="stat-item">
                    <h3 class="stat-value" id="totalGames">0</h3>
                    <p>Total Games</p>
                </div>
                <div class="stat-item">
                    <h3 class="stat-value" id="totalUploads">0</h3>
                    <p>Games Uploaded</p>
                </div>
                <div class="stat-item">
                    <h3 class="stat-value" id="totalPlays">0</h3>
                    <p>Total Plays</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Game Player Modal -->
    <div class="game-modal" id="gameModal" role="dialog" aria-labelledby="modalGameTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalGameTitle">Loading Game...</h2>
                <button class="close-modal" onclick="closeGameModal()" aria-label="Close game">
                    &times;
                </button>
            </div>
            <div class="modal-loader" id="modalLoader">
                <div class="loader" aria-hidden="true"></div>
                <span class="sr-only">Loading game...</span>
            </div>
            <iframe class="game-frame" id="gameFrame" title="Game Player" 
                    sandbox="allow-scripts allow-same-origin allow-forms allow-popups"
                    aria-label="Game content area"></iframe>
        </div>
    </div>

    <!-- Login/Signup Modal -->
    <div class="auth-modal" id="authModal" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="auth-modal-content">
            <div class="auth-modal-header">
                <h2 class="auth-modal-title" id="authModalTitle">Login</h2>
                <button class="auth-close-modal" id="authCloseModal" aria-label="Close authentication modal">
                    &times;
                </button>
            </div>
            <div class="auth-modal-body">
                <form class="auth-form" id="authForm">
                    <div class="auth-form-group">
                        <label for="authEmail">Email Address</label>
                        <input type="email" id="authEmail" required placeholder="Enter your email">
                    </div>
                    
                    <div class="auth-form-group">
                        <label for="authPassword">Password</label>
                        <input type="password" id="authPassword" required placeholder="Enter your password">
                        <button type="button" class="password-toggle" id="passwordToggle" aria-label="Show password">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    
                    <div class="auth-error" id="authError">
                        Invalid email or password. Please try again.
                    </div>
                    
                    <div class="auth-form-actions">
                        <button type="submit" class="btn btn-primary" id="authSubmitBtn">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </button>
                        <div class="auth-switch-text">
                            <span id="authSwitchText">Don't have an account?</span>
                            <button type="button" class="auth-switch-link" id="authSwitchLink">
                                Sign Up
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Welcome Message Modal -->
    <div class="welcome-modal" id="welcomeModal" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="welcome-modal-content">
            <div class="welcome-modal-header">
                <h2 class="welcome-modal-title">Welcome to the Educational Games Platform</h2>
                <button class="welcome-close-modal" id="welcomeCloseModal" aria-label="Close welcome modal">
                    &times;
                </button>
            </div>
            <div class="welcome-modal-body">
                <div class="welcome-message">
                    <p>This is a unique, modern website designed for educational games, combining a playful visual style with a clean, professional layout. The design is carefully balanced to appeal to learners while maintaining credibility for educators and parents.</p>
                    <p>This platform allows users to upload educational games easily, which users can then access and play directly on the website without additional downloads. It supports interactive learning experiences that encourage engagement, creativity, and skill development.</p>
                </div>
                
                <div class="welcome-features">
                    <div class="welcome-feature">
                        <i class="fas fa-upload"></i>
                        <h4>Easy Upload</h4>
                        <p>Upload HTML5 games with drag & drop interface</p>
                    </div>
                    <div class="welcome-feature">
                        <i class="fas fa-gamepad"></i>
                        <h4>Play Instantly</h4>
                        <p>No downloads required - play directly in browser</p>
                    </div>
                    <div class="welcome-feature">
                        <i class="fas fa-users"></i>
                        <h4>Community</h4>
                        <p>Share and discover games from other educators</p>
                    </div>
                    <div class="welcome-feature">
                        <i class="fas fa-graduation-cap"></i>
                        <h4>Educational</h4>
                        <p>Designed for learning and skill development</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification" role="alert" aria-live="polite"></div>

    <!-- Footer -->
    <footer id="about">
        <div class="footer-container">
            <div class="footer-about">
                <div class="footer-logo">
                    <i class="fas fa-gamepad"></i>
                    <h2>EducationalGamez.com</h2>
                </div>
                <p>Upload, share, and play educational HTML5 games. Our platform provides a secure sandbox for running user-uploaded games directly in the browser.</p>
                <div class="social-links">
                    <a href="#" class="social-link" aria-label="Follow us on Facebook"><i class="fab fa-facebook"></i></a>
                    <a href="#" class="social-link" aria-label="Follow us on Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="social-link" aria-label="Follow us on GitHub"><i class="fab fa-github"></i></a>
                    <a href="#" class="social-link" aria-label="Subscribe to our YouTube channel"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
            
            <div class="footer-links">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="#home" id="homeFooterLink">Home</a></li>
                    <li><a href="#library">Game Library</a></li>
                    <li><a href="#upload">Upload Game</a></li>
                    <li><a href="developers.html" id="devDocs">Developer Docs</a></li>
                    <li><a href="privacy-policy.html" id="privacyPolicy">Privacy Policy</a></li>
                    <li><a href="terms-of-service.html" id="termsOfService">Terms of Service</a></li>
                </ul>
            </div>
            
            <div class="footer-contact">
                <h3>Contact Us</h3>
                <p><i class="fas fa-envelope"></i> support@educationalgamez.com</p>
                <p><i class="fas fa-globe"></i> www.educationalgamez.com</p>
                <p><i class="fas fa-question-circle"></i> Need help uploading? Check our FAQ</p>
            </div>
        </div>
        
        <div class="copyright">
            <p>&copy; <span id="currentYear"></span> EducationalGamez.com. All rights reserved. | Games run in a secure sandbox environment</p>
        </div>
    </footer>

    <script>
        // ============================
        // USER AUTHENTICATION SYSTEM
        // ============================
        class UserAuth {
            constructor() {
                this.USERS_KEY = 'educational_games_users';
                this.CURRENT_USER_KEY = 'current_user';
                this.initStorage();
            }
            
            initStorage() {
                if (!localStorage.getItem(this.USERS_KEY)) {
                    // Create some demo users for testing
                    const demoUsers = [
                        {
                            id: 1,
                            email: 'demo@example.com',
                            password: 'demo123',
                            name: 'Demo User',
                            joined: new Date().toISOString(),
                            games: []
                        },
                        {
                            id: 2,
                            email: 'test@example.com',
                            password: 'test123',
                            name: 'Test User',
                            joined: new Date().toISOString(),
                            games: []
                        }
                    ];
                    localStorage.setItem(this.USERS_KEY, JSON.stringify(demoUsers));
                }
            }
            
            getAllUsers() {
                try {
                    return JSON.parse(localStorage.getItem(this.USERS_KEY)) || [];
                } catch (e) {
                    return [];
                }
            }
            
            getCurrentUser() {
                try {
                    return JSON.parse(localStorage.getItem(this.CURRENT_USER_KEY));
                } catch (e) {
                    return null;
                }
            }
            
            setCurrentUser(user) {
                localStorage.setItem(this.CURRENT_USER_KEY, JSON.stringify(user));
            }
            
            clearCurrentUser() {
                localStorage.removeItem(this.CURRENT_USER_KEY);
            }
            
            login(email, password) {
                const users = this.getAllUsers();
                const user = users.find(u => u.email === email && u.password === password);
                
                if (user) {
                    // Remove password from stored user object for security
                    const { password, ...userWithoutPassword } = user;
                    this.setCurrentUser(userWithoutPassword);
                    return { success: true, user: userWithoutPassword };
                }
                
                return { success: false, message: 'Invalid email or password' };
            }
            
            signup(email, password, name) {
                const users = this.getAllUsers();
                
                // Check if user already exists
                if (users.some(u => u.email === email)) {
                    return { success: false, message: 'Email already registered' };
                }
                
                // Validate email format
                if (!this.validateEmail(email)) {
                    return { success: false, message: 'Invalid email format' };
                }
                
                // Validate password
                if (password.length < 6) {
                    return { success: false, message: 'Password must be at least 6 characters' };
                }
                
                // Create new user
                const newUser = {
                    id: Date.now(), // Simple ID generation
                    email: email,
                    password: password,
                    name: name || email.split('@')[0], // Use part of email as name if not provided
                    joined: new Date().toISOString(),
                    games: []
                };
                
                users.push(newUser);
                localStorage.setItem(this.USERS_KEY, JSON.stringify(users));
                
                // Remove password from stored user object
                const { password: _, ...userWithoutPassword } = newUser;
                this.setCurrentUser(userWithoutPassword);
                
                return { success: true, user: userWithoutPassword };
            }
            
            logout() {
                this.clearCurrentUser();
                return { success: true };
            }
            
            validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }
            
            updateUser(userId, updates) {
                const users = this.getAllUsers();
                const userIndex = users.findIndex(u => u.id === userId);
                
                if (userIndex !== -1) {
                    users[userIndex] = { ...users[userIndex], ...updates };
                    localStorage.setItem(this.USERS_KEY, JSON.stringify(users));
                    
                    // Update current user if it's the same user
                    const currentUser = this.getCurrentUser();
                    if (currentUser && currentUser.id === userId) {
                        this.setCurrentUser({ ...currentUser, ...updates });
                    }
                    
                    return true;
                }
                
                return false;
            }
            
            getUserById(id) {
                const users = this.getAllUsers();
                const user = users.find(u => u.id === id);
                if (user) {
                    const { password, ...userWithoutPassword } = user;
                    return userWithoutPassword;
                }
                return null;
            }
        }

        // ============================
        // GAME STORAGE MANAGEMENT
        // ============================
        class GameStorage {
            constructor() {
                this.STORAGE_KEY = 'educational_games_v2';
                this.STATS_KEY = 'game_stats_v2';
                this.MAX_STORAGE_SIZE = 5 * 1024 * 1024; // 5MB max
                this.initStorage();
            }
            
            initStorage() {
                if (!localStorage.getItem(this.STORAGE_KEY)) {
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify({
                        games: [],
                        nextId: 1
                    }));
                }
                
                if (!localStorage.getItem(this.STATS_KEY)) {
                    localStorage.setItem(this.STATS_KEY, JSON.stringify({
                        totalPlays: 0,
                        totalUploads: 0,
                        lastGameId: 0
                    }));
                }
            }
            
            getAllGames() {
                try {
                    const data = JSON.parse(localStorage.getItem(this.STORAGE_KEY));
                    return data.games || [];
                } catch (e) {
                    console.error('Error reading games from storage:', e);
                    return [];
                }
            }
            
            getGameById(id) {
                const games = this.getAllGames();
                return games.find(game => game.id === id);
            }
            
            saveGame(gameData) {
                try {
                    const data = JSON.parse(localStorage.getItem(this.STORAGE_KEY));
                    const stats = JSON.parse(localStorage.getItem(this.STATS_KEY));
                    
                    // Generate unique ID
                    const gameId = data.nextId++;
                    
                    // Create game object
                    const game = {
                        id: gameId,
                        title: gameData.title,
                        category: gameData.category,
                        description: gameData.description,
                        ageRange: gameData.ageRange || 'All ages',
                        mainFile: gameData.mainFile,
                        files: gameData.files,
                        fileCount: gameData.files ? Object.keys(gameData.files).length : 0,
                        totalSize: gameData.totalSize || 0,
                        uploadDate: new Date().toISOString(),
                        playCount: 0,
                        type: 'uploaded',
                        userId: gameData.userId || null
                    };
                    
                    // Add to games array
                    data.games.push(game);
                    
                    // Update stats
                    stats.totalUploads++;
                    stats.lastGameId = gameId;
                    
                    // Save to localStorage
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
                    localStorage.setItem(this.STATS_KEY, JSON.stringify(stats));
                    
                    return game;
                    
                } catch (e) {
                    console.error('Error saving game:', e);
                    throw new Error('Failed to save game. Storage might be full.');
                }
            }
            
            updateGame(id, updates) {
                const data = JSON.parse(localStorage.getItem(this.STORAGE_KEY));
                const gameIndex = data.games.findIndex(game => game.id === id);
                
                if (gameIndex !== -1) {
                    data.games[gameIndex] = { ...data.games[gameIndex], ...updates };
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
                    return true;
                }
                
                return false;
            }
            
            deleteGame(id) {
                const data = JSON.parse(localStorage.getItem(this.STORAGE_KEY));
                const initialLength = data.games.length;
                
                data.games = data.games.filter(game => game.id !== id);
                
                if (data.games.length !== initialLength) {
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
                    return true;
                }
                
                return false;
            }
            
            incrementPlayCount(id) {
                const stats = JSON.parse(localStorage.getItem(this.STATS_KEY));
                const game = this.getGameById(id);
                
                if (game) {
                    game.playCount = (game.playCount || 0) + 1;
                    stats.totalPlays++;
                    
                    this.updateGame(id, { playCount: game.playCount });
                    localStorage.setItem(this.STATS_KEY, JSON.stringify(stats));
                    return true;
                }
                
                return false;
            }
            
            getStats() {
                try {
                    const stats = JSON.parse(localStorage.getItem(this.STATS_KEY));
                    const games = this.getAllGames();
                    
                    return {
                        totalGames: games.length,
                        totalUploads: stats.totalUploads || 0,
                        totalPlays: stats.totalPlays || 0
                    };
                } catch (e) {
                    return {
                        totalGames: 0,
                        totalUploads: 0,
                        totalPlays: 0
                    };
                }
            }
            
            getStorageUsage() {
                const data = localStorage.getItem(this.STORAGE_KEY);
                return data ? data.length : 0;
            }
            
            clearAllGames() {
                localStorage.removeItem(this.STORAGE_KEY);
                localStorage.removeItem(this.STATS_KEY);
                this.initStorage();
            }
            
            getUserGames(userId) {
                const games = this.getAllGames();
                return games.filter(game => game.userId === userId);
            }
        }

        // ============================
        // GAME UPLOAD HANDLER
        // ============================
        class GameUploadHandler {
            constructor() {
                this.files = [];
                this.fileContents = {};
                this.maxFileSize = 1024 * 1024; // 1MB per file
                this.maxTotalSize = 5 * 1024 * 1024; // 5MB total
            }
            
            async processFiles(fileList) {
                this.files = Array.from(fileList);
                this.fileContents = {};
                
                // Check total size
                const totalSize = this.files.reduce((sum, file) => sum + file.size, 0);
                if (totalSize > this.maxTotalSize) {
                    throw new Error(`Total file size (${this.formatFileSize(totalSize)}) exceeds maximum allowed (${this.formatFileSize(this.maxTotalSize)})`);
                }
                
                // Check individual file sizes
                for (const file of this.files) {
                    if (file.size > this.maxFileSize) {
                        throw new Error(`File "${file.name}" (${this.formatFileSize(file.size)}) exceeds maximum size (${this.formatFileSize(this.maxFileSize)})`);
                    }
                    
                    // Check file type
                    if (!this.isAllowedFileType(file.name)) {
                        throw new Error(`File type not supported: ${file.name}. Supported: HTML, JS, CSS, PNG, JPG, GIF`);
                    }
                }
                
                // Read files
                for (let i = 0; i < this.files.length; i++) {
                    const file = this.files[i];
                    try {
                        const content = await this.readFileAsText(file);
                        this.fileContents[file.name] = {
                            name: file.name,
                            content: content,
                            size: file.size,
                            type: file.type,
                            lastModified: file.lastModified
                        };
                    } catch (error) {
                        throw new Error(`Failed to read file "${file.name}": ${error.message}`);
                    }
                }
                
                return {
                    files: this.fileContents,
                    totalSize: totalSize,
                    fileCount: this.files.length
                };
            }
            
            readFileAsText(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (event) => resolve(event.target.result);
                    reader.onerror = (error) => reject(error);
                    
                    if (file.type.startsWith('image/')) {
                        // For images, read as data URL
                        reader.readAsDataURL(file);
                    } else {
                        // For text files, read as text
                        reader.readAsText(file);
                    }
                });
            }
            
            isAllowedFileType(filename) {
                const allowedExtensions = ['.html', '.htm', '.js', '.css', '.png', '.jpg', '.jpeg', '.gif'];
                const extension = filename.toLowerCase().substring(filename.lastIndexOf('.'));
                return allowedExtensions.includes(extension);
            }
            
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            reset() {
                this.files = [];
                this.fileContents = {};
            }
        }

        // ============================
        // GAME PLAYER
        // ============================
        class GamePlayer {
            constructor() {
                this.currentGame = null;
                this.storage = new GameStorage();
                this.platform = null; // Will be set by GamePlatform
            }
            
            setPlatform(platform) {
                this.platform = platform;
            }
            
            async playGame(gameId) {
                try {
                    let game;
                    
                    // Check if it's a sample game (negative ID) or stored game
                    if (gameId < 0) {
                        // It's a sample game - get from platform's sampleGames
                        game = this.platform ? this.platform.getSampleGameById(gameId) : null;
                        if (game) {
                            // Increment play count for sample games
                            game.playCount = (game.playCount || 0) + 1;
                            this.platform.updateStats();
                            this.platform.loadGames(); // Refresh to update play count display
                        }
                    } else {
                        // It's a stored game
                        game = this.storage.getGameById(gameId);
                        if (game) {
                            this.storage.incrementPlayCount(gameId);
                        }
                    }
                    
                    if (!game) {
                        throw new Error('Game not found');
                    }
                    
                    this.currentGame = game;
                    this.openGameModal(game);
                    
                } catch (error) {
                    this.showNotification(`Error loading game: ${error.message}`, 'error');
                }
            }
            
            openGameModal(game) {
                const modal = document.getElementById('gameModal');
                const loader = document.getElementById('modalLoader');
                const iframe = document.getElementById('gameFrame');
                const title = document.getElementById('modalGameTitle');
                
                title.textContent = game.title;
                modal.classList.add('active');
                loader.style.display = 'flex';
                iframe.style.display = 'none';
                
                // Prevent body scrolling
                document.body.style.overflow = 'hidden';
                
                // Focus close button for accessibility
                setTimeout(() => {
                    document.querySelector('.close-modal').focus();
                }, 100);
                
                // Load game after short delay
                setTimeout(() => {
                    this.loadGame(game, iframe, loader);
                }, 500);
            }
            
            async loadGame(game, iframe, loader) {
                try {
                    // Create HTML document for the game
                    const gameHtml = this.createGameHTML(game);
                    
                    // Create blob and URL
                    const blob = new Blob([gameHtml], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    
                    // Set iframe source
                    iframe.src = url;
                    
                    // Handle load complete
                    iframe.onload = () => {
                        setTimeout(() => {
                            loader.style.display = 'none';
                            iframe.style.display = 'block';
                        }, 300);
                    };
                    
                    // Handle errors
                    iframe.onerror = () => {
                        loader.innerHTML = `
                            <div style="text-align: center; color: var(--danger);">
                                <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                                <h3>Error Loading Game</h3>
                                <p>The game could not be loaded.</p>
                                <button class="btn btn-primary" onclick="gamePlayer.closeGameModal()" style="margin-top: 1rem;">
                                    Close
                                </button>
                            </div>
                        `;
                    };
                    
                } catch (error) {
                    console.error('Error loading game:', error);
                    loader.innerHTML = `
                        <div style="text-align: center; color: var(--danger);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3>Error Loading Game</h3>
                            <p>${error.message}</p>
                            <button class="btn btn-primary" onclick="gamePlayer.closeGameModal()" style="margin-top: 1rem;">
                                Close
                            </button>
                        </div>
                    `;
                }
            }
            
            createGameHTML(game) {
                // For sample games with HTML content already defined
                if (game.htmlContent) {
                    return game.htmlContent;
                }
                
                // For uploaded games with files
                if (game.files && game.mainFile && game.files[game.mainFile]) {
                    const mainFile = game.files[game.mainFile];
                    let htmlContent = mainFile.content;
                    
                    // If it's an image, wrap it in HTML
                    if (mainFile.name.match(/\.(png|jpg|jpeg|gif)$/i)) {
                        htmlContent = `
                            <!DOCTYPE html>
                            <html>
                            <head>
                                <meta charset="UTF-8">
                                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                                <style>
                                    body { 
                                        margin: 0; 
                                        padding: 20px; 
                                        display: flex; 
                                        flex-direction: column; 
                                        align-items: center; 
                                        justify-content: center; 
                                        min-height: 100vh; 
                                        background: #f5f5f5; 
                                        font-family: Arial, sans-serif; 
                                    }
                                    .game-container { 
                                        max-width: 800px; 
                                        width: 100%; 
                                        text-align: center; 
                                    }
                                    h1 { 
                                        margin-bottom: 20px; 
                                        color: #333; 
                                    }
                                    img { 
                                        max-width: 100%; 
                                        height: auto; 
                                        border-radius: 10px; 
                                        box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
                                    }
                                    .info { 
                                        margin-top: 20px; 
                                        padding: 15px; 
                                        background: white; 
                                        border-radius: 10px; 
                                        box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
                                    }
                                </style>
                            </head>
                            <body>
                                <div class="game-container">
                                    <h1>${game.title}</h1>
                                    <img src="${mainFile.content}" alt="${game.title}">
                                    <div class="info">
                                        <p><strong>Category:</strong> ${this.formatCategory(game.category)}</p>
                                        <p><strong>Description:</strong> ${game.description}</p>
                                        <p><strong>Age Range:</strong> ${game.ageRange}</p>
                                    </div>
                                </div>
                            </body>
                            </html>
                        `;
                    }
                    
                    // Inject game files into the HTML
                    htmlContent = this.injectGameResources(htmlContent, game.files);
                    
                    return htmlContent;
                }
                
                // Fallback: create a simple game page
                return this.createSimpleGamePage(game);
            }
            
            createSimpleGamePage(game) {
                // Create a simple interactive game based on category
                let gameContent = '';
                
                switch(game.category) {
                    case 'math':
                        gameContent = this.createMathGameContent();
                        break;
                    case 'science':
                        gameContent = this.createScienceGameContent();
                        break;
                    case 'language':
                        gameContent = this.createWordGameContent();
                        break;
                    case 'other':
                        gameContent = this.createOtherGameContent();
                        break;
                    default:
                        gameContent = this.createGenericGameContent();
                }
                
                return `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>${game.title}</title>
                        <style>
                            body {
                                font-family: 'Arial', sans-serif;
                                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                min-height: 100vh;
                                display: flex;
                                flex-direction: column;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                padding: 20px;
                                margin: 0;
                            }
                            
                            .game-container {
                                max-width: 800px;
                                width: 100%;
                                background: rgba(255, 255, 255, 0.1);
                                backdrop-filter: blur(10px);
                                border-radius: 20px;
                                padding: 30px;
                                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
                                border: 1px solid rgba(255, 255, 255, 0.2);
                                text-align: center;
                            }
                            
                            h1 {
                                font-size: 2.5rem;
                                margin-bottom: 20px;
                                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                            }
                            
                            .game-content {
                                margin: 30px 0;
                            }
                            
                            .btn {
                                background: #ff9e5d;
                                border: none;
                                border-radius: 50px;
                                padding: 12px 30px;
                                color: white;
                                font-size: 1.2rem;
                                cursor: pointer;
                                transition: all 0.3s;
                                font-weight: bold;
                                margin: 10px;
                            }
                            
                            .btn:hover {
                                background: #ff8e42;
                                transform: translateY(-3px);
                                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                            }
                            
                            .score {
                                font-size: 1.5rem;
                                margin: 20px 0;
                                color: #ff9e5d;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="game-container">
                            <h1>${game.title}</h1>
                            <p>${game.description}</p>
                            <div class="game-content">
                                ${gameContent}
                            </div>
                            <div class="score">Score: <span id="score">0</span></div>
                            <button class="btn" onclick="window.parent.gamePlayer.closeGameModal()">Exit Game</button>
                        </div>
                        <script>
                            // Simple game logic
                            let score = 0;
                            const scoreElement = document.getElementById('score');
                            
                            function updateScore(points) {
                                score += points;
                                scoreElement.textContent = score;
                            }
                        <\/script>
                    </body>
                    </html>
                `;
            }
            
            createMathGameContent() {
                return `
                    <div id="math-game">
                        <h2>Math Challenge</h2>
                        <div id="math-problem" style="font-size: 2.5rem; margin: 20px 0;">5 + 3 = ?</div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-width: 300px; margin: 0 auto;">
                            <button class="btn" onclick="checkMathAnswer(8)">8</button>
                            <button class="btn" onclick="checkMathAnswer(7)">7</button>
                            <button class="btn" onclick="checkMathAnswer(9)">9</button>
                            <button class="btn" onclick="checkMathAnswer(6)">6</button>
                        </div>
                        <div id="math-feedback" style="margin: 20px 0; font-size: 1.2rem;"></div>
                    </div>
                    <script>
                        let currentProblem = { num1: 5, num2: 3, operator: '+', answer: 8 };
                        
                        function generateMathProblem() {
                            const operators = ['+', '-', '', ''];
                            const operator = operators[Math.floor(Math.random() * operators.length)];
                            let num1, num2, answer;
                            
                            switch(operator) {
                                case '+':
                                    num1 = Math.floor(Math.random() * 20) + 1;
                                    num2 = Math.floor(Math.random() * 20) + 1;
                                    answer = num1 + num2;
                                    break;
                                case '-':
                                    num1 = Math.floor(Math.random() * 20) + 10;
                                    num2 = Math.floor(Math.random() * 10) + 1;
                                    answer = num1 - num2;
                                    break;
                                case '':
                                    num1 = Math.floor(Math.random() * 10) + 1;
                                    num2 = Math.floor(Math.random() * 10) + 1;
                                    answer = num1 * num2;
                                    break;
                                case '':
                                    num2 = Math.floor(Math.random() * 5) + 2;
                                    answer = Math.floor(Math.random() * 5) + 2;
                                    num1 = num2 * answer;
                                    break;
                            }
                            
                            currentProblem = { num1, num2, operator, answer };
                            document.getElementById('math-problem').textContent = \`\${num1} \${operator} \${num2} = ?\`;
                            
                            // Generate answer options
                            const answers = [answer];
                            while (answers.length < 4) {
                                const wrongAnswer = answer + Math.floor(Math.random() * 10) - 5;
                                if (wrongAnswer !== answer && wrongAnswer > 0 && !answers.includes(wrongAnswer)) {
                                    answers.push(wrongAnswer);
                                }
                            }
                            
                            // Shuffle answers
                            answers.sort(() => Math.random() - 0.5);
                            
                            // Update buttons
                            const buttons = document.querySelectorAll('#math-game .btn');
                            buttons.forEach((btn, i) => {
                                btn.textContent = answers[i];
                                btn.onclick = () => checkMathAnswer(answers[i]);
                            });
                            
                            document.getElementById('math-feedback').textContent = '';
                        }
                        
                        function checkMathAnswer(selectedAnswer) {
                            const feedback = document.getElementById('math-feedback');
                            if (selectedAnswer === currentProblem.answer) {
                                feedback.textContent = 'Correct! ';
                                feedback.style.color = '#4CAF50';
                                updateScore(10);
                            } else {
                                feedback.textContent = \`Incorrect. The answer is \${currentProblem.answer}\`;
                                feedback.style.color = '#F44336';
                            }
                            
                            setTimeout(generateMathProblem, 1500);
                        }
                        
                        // Start the game
                        generateMathProblem();
                    <\/script>
                `;
            }
            
            createScienceGameContent() {
                return `
                    <div id="science-game">
                        <h2>Science Quiz</h2>
                        <div id="science-question" style="font-size: 1.5rem; margin: 20px 0; min-height: 60px;">
                            What is the largest planet in our solar system?
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 10px; max-width: 400px; margin: 0 auto;">
                            <button class="btn" onclick="checkScienceAnswer(0)">Earth</button>
                            <button class="btn" onclick="checkScienceAnswer(1)">Jupiter</button>
                            <button class="btn" onclick="checkScienceAnswer(2)">Saturn</button>
                            <button class="btn" onclick="checkScienceAnswer(3)">Mars</button>
                        </div>
                        <div id="science-feedback" style="margin: 20px 0; font-size: 1.2rem;"></div>
                    </div>
                    <script>
                        const scienceQuestions = [
                            {
                                question: "What is the largest planet in our solar system?",
                                options: ["Earth", "Jupiter", "Saturn", "Mars"],
                                answer: 1
                            },
                            {
                                question: "What gas do plants absorb from the atmosphere?",
                                options: ["Oxygen", "Carbon Dioxide", "Nitrogen", "Hydrogen"],
                                answer: 1
                            },
                            {
                                question: "What is the chemical symbol for gold?",
                                options: ["Go", "Gd", "Au", "Ag"],
                                answer: 2
                            },
                            {
                                question: "What is the hardest natural substance on Earth?",
                                options: ["Gold", "Iron", "Diamond", "Platinum"],
                                answer: 2
                            },
                            {
                                question: "How many bones are in the adult human body?",
                                options: ["206", "150", "300", "106"],
                                answer: 0
                            }
                        ];
                        
                        let currentQuestionIndex = 0;
                        
                        function loadScienceQuestion() {
                            const question = scienceQuestions[currentQuestionIndex];
                            document.getElementById('science-question').textContent = question.question;
                            
                            const buttons = document.querySelectorAll('#science-game .btn');
                            buttons.forEach((btn, i) => {
                                btn.textContent = question.options[i];
                                btn.onclick = () => checkScienceAnswer(i);
                            });
                            
                            document.getElementById('science-feedback').textContent = '';
                        }
                        
                        function checkScienceAnswer(selectedIndex) {
                            const question = scienceQuestions[currentQuestionIndex];
                            const feedback = document.getElementById('science-feedback');
                            
                            if (selectedIndex === question.answer) {
                                feedback.textContent = 'Correct! ';
                                feedback.style.color = '#4CAF50';
                                updateScore(10);
                            } else {
                                feedback.textContent = \`Incorrect. The answer is \${question.options[question.answer]}\`;
                                feedback.style.color = '#F44336';
                            }
                            
                            currentQuestionIndex = (currentQuestionIndex + 1) % scienceQuestions.length;
                            setTimeout(loadScienceQuestion, 1500);
                        }
                        
                        // Start the quiz
                        loadScienceQuestion();
                    <\/script>
                `;
            }
            
            createWordGameContent() {
                return `
                    <div id="word-game">
                        <h2>Word Challenge</h2>
                        <div style="margin: 20px 0;">
                            <div id="scrambled-word" style="font-size: 2.5rem; letter-spacing: 5px; margin: 20px 0;">ELPPA</div>
                            <input type="text" id="word-input" placeholder="Type the unscrambled word" 
                                   style="padding: 10px; font-size: 1.2rem; width: 200px; text-align: center; border-radius: 5px; border: 2px solid #ccc;">
                            <button class="btn" onclick="checkWord()" style="margin-left: 10px;">Submit</button>
                        </div>
                        <div id="word-feedback" style="margin: 20px 0; font-size: 1.2rem;"></div>
                        <button class="btn" onclick="getHint()">Get Hint</button>
                    </div>
                    <script>
                        const words = [
                            { scrambled: "ELPPA", word: "APPLE", hint: "A fruit that keeps the doctor away" },
                            { scrambled: "NABANAB", word: "BANANA", hint: "A yellow curved fruit" },
                            { scrambled: "RAGEON", word: "ORANGE", hint: "A citrus fruit and a color" },
                            { scrambled: "MTOATO", word: "TOMATO", hint: "Red fruit often used in salads" },
                            { scrambled: "RWOSTBERRY", word: "STRAWBERRY", hint: "Red berry with seeds on the outside" }
                        ];
                        
                        let currentWordIndex = 0;
                        
                        function loadWord() {
                            const word = words[currentWordIndex];
                            document.getElementById('scrambled-word').textContent = word.scrambled;
                            document.getElementById('word-input').value = '';
                            document.getElementById('word-feedback').textContent = '';
                        }
                        
                        function checkWord() {
                            const input = document.getElementById('word-input').value.toUpperCase();
                            const word = words[currentWordIndex];
                            const feedback = document.getElementById('word-feedback');
                            
                            if (input === word.word) {
                                feedback.textContent = 'Correct! ';
                                feedback.style.color = '#4CAF50';
                                updateScore(15);
                                currentWordIndex = (currentWordIndex + 1) % words.length;
                                setTimeout(loadWord, 1500);
                            } else {
                                feedback.textContent = 'Try again!';
                                feedback.style.color = '#F44336';
                            }
                        }
                        
                        function getHint() {
                            const word = words[currentWordIndex];
                            document.getElementById('word-feedback').textContent = \`Hint: \${word.hint}\`;
                            document.getElementById('word-feedback').style.color = '#FF9800';
                            updateScore(-5);
                        }
                        
                        // Start the game
                        loadWord();
                        
                        // Allow pressing Enter to submit
                        document.getElementById('word-input').addEventListener('keypress', function(e) {
                            if (e.key === 'Enter') {
                                checkWord();
                            }
                        });
                    <\/script>
                `;
            }
            
            createOtherGameContent() {
                // This will be a simple placeholder for the mobile.spelling.html game
                return `
                    <div id="spelling-game">
                        <h2>Mobile Spelling Game</h2>
                        <div style="margin: 20px 0;">
                            <div id="word-to-spell" style="font-size: 2rem; margin: 20px 0; color: #ff9e5d;">CAT</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 20px 0;">
                                <button class="btn" onclick="addLetter('C')">C</button>
                                <button class="btn" onclick="addLetter('A')">A</button>
                                <button class="btn" onclick="addLetter('T')">T</button>
                                <button class="btn" onclick="addLetter('D')">D</button>
                                <button class="btn" onclick="addLetter('O')">O</button>
                                <button class="btn" onclick="addLetter('G')">G</button>
                            </div>
                            <div style="margin: 20px 0;">
                                <div id="spelling-area" style="font-size: 2rem; letter-spacing: 10px; min-height: 50px; border-bottom: 2px solid #ccc; padding: 10px;"></div>
                            </div>
                            <div style="display: flex; gap: 10px; justify-content: center;">
                                <button class="btn" onclick="clearSpelling()">Clear</button>
                                <button class="btn" onclick="checkSpelling()">Check</button>
                                <button class="btn" onclick="nextWord()">Next</button>
                            </div>
                        </div>
                        <div id="spelling-feedback" style="margin: 20px 0; font-size: 1.2rem;"></div>
                    </div>
                    <script>
                        const spellingWords = ['CAT', 'DOG', 'SUN', 'MOON', 'STAR', 'FISH', 'BOOK', 'TREE', 'BALL', 'CAKE'];
                        let currentSpellingWordIndex = 0;
                        let currentLetters = [];
                        
                        function loadSpellingWord() {
                            const word = spellingWords[currentSpellingWordIndex];
                            document.getElementById('word-to-spell').textContent = word;
                            document.getElementById('spelling-area').textContent = '';
                            document.getElementById('spelling-feedback').textContent = '';
                            currentLetters = [];
                        }
                        
                        function addLetter(letter) {
                            if (currentLetters.length < 10) {
                                currentLetters.push(letter);
                                document.getElementById('spelling-area').textContent = currentLetters.join('');
                            }
                        }
                        
                        function clearSpelling() {
                            currentLetters = [];
                            document.getElementById('spelling-area').textContent = '';
                            document.getElementById('spelling-feedback').textContent = '';
                        }
                        
                        function checkSpelling() {
                            const word = spellingWords[currentSpellingWordIndex];
                            const userWord = currentLetters.join('');
                            const feedback = document.getElementById('spelling-feedback');
                            
                            if (userWord === word) {
                                feedback.textContent = 'Excellent! Correct spelling! ';
                                feedback.style.color = '#4CAF50';
                                updateScore(20);
                            } else {
                                feedback.textContent = \`Almost! The correct spelling is "\${word}"\`;
                                feedback.style.color = '#F44336';
                            }
                        }
                        
                        function nextWord() {
                            currentSpellingWordIndex = (currentSpellingWordIndex + 1) % spellingWords.length;
                            loadSpellingWord();
                        }
                        
                        // Start the game
                        loadSpellingWord();
                    <\/script>
                `;
            }
            
            createGenericGameContent() {
                return `
                    <div id="generic-game">
                        <h2>Educational Challenge</h2>
                        <p>Test your knowledge with this interactive game!</p>
                        <div style="margin: 30px 0;">
                            <button class="btn" onclick="correctAnswer()" style="background: #4CAF50;">Correct Answer</button>
                            <button class="btn" onclick="wrongAnswer()" style="background: #F44336;">Wrong Answer</button>
                        </div>
                        <div id="generic-feedback" style="margin: 20px 0; font-size: 1.2rem;"></div>
                    </div>
                    <script>
                        function correctAnswer() {
                            document.getElementById('generic-feedback').textContent = 'Well done! That\'s correct! ';
                            document.getElementById('generic-feedback').style.color = '#4CAF50';
                            updateScore(10);
                        }
                        
                        function wrongAnswer() {
                            document.getElementById('generic-feedback').textContent = 'Oops! That\'s not right. Try again!';
                            document.getElementById('generic-feedback').style.color = '#F44336';
                        }
                    <\/script>
                `;
            }
            
            injectGameResources(htmlContent, files) {
                // Replace script src references
                for (const [filename, file] of Object.entries(files)) {
                    if (filename.endsWith('.js')) {
                        // Create script tag with inline content
                        const scriptContent = `
                            <script>
                                ${file.content}
                            <\/script>
                        `;
                        htmlContent = htmlContent.replace(
                            new RegExp(`<script[^>]*src=["'][^"']*${filename.replace('.', '\\.')}[^"']*["'][^>]*><\\/script>`, 'gi'),
                            scriptContent
                        );
                    }
                    
                    if (filename.endsWith('.css')) {
                        // Create style tag with inline content
                        const styleContent = `
                            <style>
                                ${file.content}
                            </style>
                        `;
                        htmlContent = htmlContent.replace(
                            new RegExp(`<link[^>]*href=["'][^"']*${filename.replace('.', '\\.')}[^"']*["'][^>]*>`, 'gi'),
                            styleContent
                        );
                    }
                    
                    if (filename.match(/\.(png|jpg|jpeg|gif)$/i)) {
                        // Replace image src references with data URLs
                        htmlContent = htmlContent.replace(
                            new RegExp(`src=["'][^"']*${filename.replace('.', '\\.')}[^"']*["']`, 'gi'),
                            `src="${file.content}"`
                        );
                    }
                }
                
                return htmlContent;
            }
            
            formatCategory(category) {
                const categories = {
                    'math': 'Mathematics',
                    'science': 'Science',
                    'language': 'Language Arts',
                    'coding': 'Programming',
                    'social': 'Social Studies',
                    'arts': 'Arts & Creativity',
                    'puzzle': 'Puzzle',
                    'other': 'Others'
                };
                return categories[category] || category;
            }
            
            closeGameModal() {
                const modal = document.getElementById('gameModal');
                const iframe = document.getElementById('gameFrame');
                
                modal.classList.remove('active');
                iframe.src = 'about:blank';
                document.body.style.overflow = '';
                
                // Return focus
                setTimeout(() => {
                    const playBtn = document.querySelector('.play-btn:focus');
                    if (playBtn) playBtn.focus();
                }, 100);
            }
            
            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type} show`;
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        }

        // ============================
        // AUTHENTICATION UI MANAGER
        // ============================
        class AuthUIManager {
            constructor(authSystem, platform) {
                this.authSystem = authSystem;
                this.platform = platform;
                this.isLoginMode = true;
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.updateUI();
            }
            
            setupEventListeners() {
                // Login/Signup buttons
                document.getElementById('loginBtn').addEventListener('click', () => {
                    this.openAuthModal(true);
                });
                
                document.getElementById('signupBtn').addEventListener('click', () => {
                    this.openAuthModal(false);
                });
                
                // Logout button
                document.getElementById('logoutBtn').addEventListener('click', () => {
                    this.logout();
                });
                
                // Auth modal close button
                document.getElementById('authCloseModal').addEventListener('click', () => {
                    this.closeAuthModal();
                });
                
                // Auth form submit
                document.getElementById('authForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleAuthSubmit();
                });
                
                // Auth mode switch
                document.getElementById('authSwitchLink').addEventListener('click', () => {
                    this.toggleAuthMode();
                });
                
                // Password toggle
                document.getElementById('passwordToggle').addEventListener('click', () => {
                    this.togglePasswordVisibility();
                });
                
                // Close modal on ESC
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && document.getElementById('authModal').classList.contains('active')) {
                        this.closeAuthModal();
                    }
                });
            }
            
            openAuthModal(isLogin = true) {
                this.isLoginMode = isLogin;
                this.updateAuthModal();
                document.getElementById('authModal').classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Focus on email field
                setTimeout(() => {
                    document.getElementById('authEmail').focus();
                }, 100);
            }
            
            closeAuthModal() {
                document.getElementById('authModal').classList.remove('active');
                document.body.style.overflow = '';
                this.clearAuthForm();
            }
            
            toggleAuthMode() {
                this.isLoginMode = !this.isLoginMode;
                this.updateAuthModal();
            }
            
            updateAuthModal() {
                const title = document.getElementById('authModalTitle');
                const submitBtn = document.getElementById('authSubmitBtn');
                const switchText = document.getElementById('authSwitchText');
                const switchLink = document.getElementById('authSwitchLink');
                
                if (this.isLoginMode) {
                    title.textContent = 'Login';
                    submitBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
                    switchText.textContent = "Don't have an account?";
                    switchLink.textContent = 'Sign Up';
                } else {
                    title.textContent = 'Sign Up';
                    submitBtn.innerHTML = '<i class="fas fa-user-plus"></i> Sign Up';
                    switchText.textContent = "Already have an account?";
                    switchLink.textContent = 'Login';
                }
                
                this.clearAuthError();
            }
            
            async handleAuthSubmit() {
                const email = document.getElementById('authEmail').value.trim();
                const password = document.getElementById('authPassword').value;
                
                // Basic validation
                if (!email || !password) {
                    this.showAuthError('Please fill in all fields');
                    return;
                }
                
                let result;
                
                if (this.isLoginMode) {
                    result = this.authSystem.login(email, password);
                } else {
                    result = this.authSystem.signup(email, password);
                }
                
                if (result.success) {
                    this.showNotification(
                        this.isLoginMode ? 'Login successful!' : 'Account created successfully!',
                        'success'
                    );
                    
                    this.closeAuthModal();
                    this.updateUI();
                    
                    // Refresh games if needed
                    if (this.platform) {
                        this.platform.loadGames();
                    }
                } else {
                    this.showAuthError(result.message || 'Authentication failed');
                }
            }
            
            logout() {
                this.authSystem.logout();
                this.showNotification('Logged out successfully', 'success');
                this.updateUI();
                
                // Refresh games to hide user-specific content
                if (this.platform) {
                    this.platform.loadGames();
                }
            }
            
            updateUI() {
                const currentUser = this.authSystem.getCurrentUser();
                const authButtons = document.querySelector('.auth-buttons');
                const userMenu = document.getElementById('userMenu');
                const userAvatar = document.getElementById('userAvatar');
                const userName = document.getElementById('userName');
                
                if (currentUser) {
                    // User is logged in
                    authButtons.style.display = 'none';
                    userMenu.classList.add('active');
                    
                    // Set user info
                    const initials = currentUser.name
                        .split(' ')
                        .map(n => n[0])
                        .join('')
                        .toUpperCase()
                        .substring(0, 2);
                    
                    userAvatar.textContent = initials;
                    userName.textContent = currentUser.name;
                } else {
                    // User is not logged in
                    authButtons.style.display = 'flex';
                    userMenu.classList.remove('active');
                }
            }
            
            togglePasswordVisibility() {
                const passwordInput = document.getElementById('authPassword');
                const toggleButton = document.getElementById('passwordToggle');
                const icon = toggleButton.querySelector('i');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.className = 'fas fa-eye-slash';
                    toggleButton.setAttribute('aria-label', 'Hide password');
                } else {
                    passwordInput.type = 'password';
                    icon.className = 'fas fa-eye';
                    toggleButton.setAttribute('aria-label', 'Show password');
                }
            }
            
            clearAuthForm() {
                document.getElementById('authEmail').value = '';
                document.getElementById('authPassword').value = '';
                this.clearAuthError();
            }
            
            showAuthError(message) {
                const errorElement = document.getElementById('authError');
                errorElement.textContent = message;
                errorElement.classList.add('show');
            }
            
            clearAuthError() {
                const errorElement = document.getElementById('authError');
                errorElement.classList.remove('show');
            }
            
            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type} show`;
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            getCurrentUser() {
                return this.authSystem.getCurrentUser();
            }
            
            isLoggedIn() {
                return this.authSystem.getCurrentUser() !== null;
            }
        }

        // ============================
        // WELCOME MESSAGE MANAGER - FIXED
        // ============================
        class WelcomeMessageManager {
            constructor() {
                this.init();
            }
            
            init() {
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                // Home logo click - show welcome modal only
                document.getElementById('homeLogo').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showWelcomeMessage();
                });
                
                // Home link in navigation - scroll to home only
                document.getElementById('homeLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    // Scroll to home section
                    const homeSection = document.querySelector('#home');
                    if (homeSection) {
                        homeSection.scrollIntoView({ behavior: 'smooth' });
                    }
                    
                    // Close mobile menu if open
                    const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
                    const navList = document.querySelector('.nav-list');
                    if (navList && navList.classList.contains('active')) {
                        mobileMenuBtn.setAttribute('aria-expanded', 'false');
                        navList.classList.remove('active');
                        mobileMenuBtn.querySelector('i').className = 'fas fa-bars';
                    }
                });
                
                // Home link in footer - scroll to home only
                document.getElementById('homeFooterLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    // Scroll to home section
                    const homeSection = document.querySelector('#home');
                    if (homeSection) {
                        homeSection.scrollIntoView({ behavior: 'smooth' });
                    }
                });
                
                // Close button in welcome modal
                document.getElementById('welcomeCloseModal').addEventListener('click', () => {
                    this.closeWelcomeMessage();
                });
                
                // Close on ESC
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && document.getElementById('welcomeModal').classList.contains('active')) {
                        this.closeWelcomeMessage();
                    }
                });
                
                // Close on outside click
                document.getElementById('welcomeModal').addEventListener('click', (e) => {
                    if (e.target === document.getElementById('welcomeModal')) {
                        this.closeWelcomeMessage();
                    }
                });
            }
            
            showWelcomeMessage() {
                const modal = document.getElementById('welcomeModal');
                if (!modal) return;
                
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Focus close button for accessibility
                setTimeout(() => {
                    const closeBtn = document.getElementById('welcomeCloseModal');
                    if (closeBtn) closeBtn.focus();
                }, 100);
            }
            
            closeWelcomeMessage() {
                const modal = document.getElementById('welcomeModal');
                if (!modal) return;
                
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        // ============================
        // MAIN APPLICATION
        // ============================
        class GamePlatform {
            constructor() {
                this.storage = new GameStorage();
                this.authSystem = new UserAuth();
                this.authUI = new AuthUIManager(this.authSystem, this);
                this.welcomeMessage = new WelcomeMessageManager();
                this.uploadHandler = new GameUploadHandler();
                this.gamePlayer = new GamePlayer();
                this.gamePlayer.setPlatform(this);
                this.currentFilter = 'all';
                this.currentSearch = '';
                
                // Sample games with HTML content already defined
                this.sampleGames = [
                    {
                        id: -1,
                        title: "Math Adventure",
                        category: "math",
                        ageRange: "8+",
                        description: "Solve math puzzles to progress through an adventure world. Practice addition, subtraction, multiplication, and division with 20 challenging levels.",
                        type: "sample",
                        uploadDate: new Date().toISOString(),
                        playCount: 42,
                        htmlContent: this.createMathGameHTML()
                    },
                    {
                        id: -2,
                        title: "Word Explorer",
                        category: "language",
                        ageRange: "10+",
                        description: "Build vocabulary by exploring islands filled with word challenges and puzzles. Features 20 different word categories to master.",
                        type: "sample",
                        uploadDate: new Date().toISOString(),
                        playCount: 28,
                        htmlContent: this.createWordGameHTML()
                    },
                    {
                        id: -3,
                        title: "Science Quest",
                        category: "science",
                        ageRange: "10+",
                        description: "Test your science knowledge with this interactive quiz covering biology, chemistry, and physics! 20 challenging questions await.",
                        type: "sample",
                        uploadDate: new Date().toISOString(),
                        playCount: 35,
                        htmlContent: this.createScienceGameHTML()
                    },
                    {
                        id: -4,
                        title: "Mobile Spelling",
                        category: "other",
                        ageRange: "6+",
                        description: "Practice spelling with this mobile-friendly game. Tap letters to spell words correctly. Great for vocabulary building!",
                        type: "sample",
                        uploadDate: new Date().toISOString(),
                        playCount: 18,
                        htmlContent: this.createMobileSpellingGameHTML()
                    }
                ];
            }
            
            createMobileSpellingGameHTML() {
                return `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>Mobile Spelling Game</title>
                        <style>
                            body {
                                font-family: 'Arial', sans-serif;
                                background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
                                min-height: 100vh;
                                display: flex;
                                flex-direction: column;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                padding: 20px;
                                margin: 0;
                                touch-action: manipulation;
                            }
                            
                            .game-container {
                                max-width: 800px;
                                width: 100%;
                                background: rgba(255, 255, 255, 0.1);
                                backdrop-filter: blur(10px);
                                border-radius: 20px;
                                padding: 30px;
                                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
                                border: 1px solid rgba(255, 255, 255, 0.2);
                                text-align: center;
                            }
                            
                            h1 {
                                font-size: 2.2rem;
                                margin-bottom: 10px;
                                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                            }
                            
                            .score-container {
                                display: flex;
                                justify-content: space-between;
                                margin: 20px 0;
                                font-size: 1.2rem;
                            }
                            
                            .word-to-spell {
                                font-size: 3rem;
                                margin: 30px 0;
                                color: #ff9e5d;
                                min-height: 80px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            }
                            
                            .spelling-area {
                                font-size: 2.5rem;
                                letter-spacing: 10px;
                                min-height: 70px;
                                border-bottom: 3px solid rgba(255, 255, 255, 0.3);
                                padding: 15px;
                                margin: 20px 0;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            }
                            
                            .keyboard {
                                display: grid;
                                grid-template-columns: repeat(6, 1fr);
                                gap: 10px;
                                margin: 30px 0;
                            }
                            
                            @media (max-width: 600px) {
                                .keyboard {
                                    grid-template-columns: repeat(5, 1fr);
                                }
                            }
                            
                            @media (max-width: 400px) {
                                .keyboard {
                                    grid-template-columns: repeat(4, 1fr);
                                }
                            }
                            
                            .key {
                                background: rgba(255, 255, 255, 0.2);
                                border: none;
                                border-radius: 10px;
                                padding: 20px 10px;
                                color: white;
                                font-size: 1.5rem;
                                cursor: pointer;
                                transition: all 0.2s;
                                font-weight: bold;
                                touch-action: manipulation;
                            }
                            
                            .key:hover {
                                background: rgba(255, 255, 255, 0.3);
                            }
                            
                            .key:active {
                                transform: scale(0.95);
                                background: rgba(255, 255, 255, 0.4);
                            }
                            
                            .controls {
                                display: flex;
                                gap: 15px;
                                justify-content: center;
                                margin-top: 20px;
                                flex-wrap: wrap;
                            }
                            
                            .control-btn {
                                background: #ff9e5d;
                                border: none;
                                border-radius: 15px;
                                padding: 15px 25px;
                                color: white;
                                font-size: 1.1rem;
                                cursor: pointer;
                                transition: all 0.3s;
                                font-weight: bold;
                                min-width: 120px;
                            }
                            
                            .control-btn:hover {
                                background: #ff8e42;
                                transform: translateY(-3px);
                            }
                            
                            .feedback {
                                font-size: 1.5rem;
                                margin: 20px 0;
                                min-height: 40px;
                                transition: all 0.3s;
                            }
                            
                            .positive {
                                color: #06d6a0;
                            }
                            
                            .negative {
                                color: #ef476f;
                            }
                            
                            .hint {
                                color: #ff9e5d;
                                font-size: 1.2rem;
                                margin: 15px 0;
                                min-height: 30px;
                            }
                            
                            .progress-bar {
                                height: 8px;
                                background: rgba(255, 255, 255, 0.2);
                                border-radius: 4px;
                                overflow: hidden;
                                margin: 20px 0;
                            }
                            
                            .progress-fill {
                                height: 100%;
                                background: #ff9e5d;
                                width: 0%;
                                transition: width 0.5s ease;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="game-container">
                            <h1>Mobile Spelling Game</h1>
                            
                            <div class="score-container">
                                <div>Score: <span id="score">0</span></div>
                                <div>Words: <span id="words-count">0/10</span></div>
                                <div>Level: <span id="level">1</span></div>
                            </div>
                            
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill"></div>
                            </div>
                            
                            <div class="word-to-spell" id="word-to-spell">CAT</div>
                            
                            <div class="hint" id="hint"></div>
                            
                            <div class="spelling-area" id="spelling-area"></div>
                            
                            <div class="keyboard" id="keyboard">
                                <!-- Keyboard will be generated by JavaScript -->
                            </div>
                            
                            <div class="feedback" id="feedback"></div>
                            
                            <div class="controls">
                                <button class="control-btn" onclick="clearSpelling()">
                                    <i class="fas fa-eraser"></i> Clear
                                </button>
                                <button class="control-btn" onclick="checkSpelling()">
                                    <i class="fas fa-check"></i> Check
                                </button>
                                <button class="control-btn" onclick="nextWord()">
                                    <i class="fas fa-forward"></i> Next
                                </button>
                                <button class="control-btn" onclick="getHint()">
                                    <i class="fas fa-lightbulb"></i> Hint
                                </button>
                            </div>
                        </div>
                        
                        <script>
                            const spellingLevels = {
                                1: {
                                    words: ['CAT', 'DOG', 'SUN', 'MOON', 'STAR', 'FISH', 'BOOK', 'TREE', 'BALL', 'CAKE'],
                                    hints: [
                                        'A small pet that says "meow"',
                                        'A loyal pet that barks',
                                        'Bright star in our sky during the day',
                                        'Shines at night in the sky',
                                        'Twinkles in the night sky',
                                        'Swims in water',
                                        'You read it',
                                        'Has leaves and branches',
                                        'Round toy you can throw',
                                        'Sweet dessert for birthdays'
                                    ]
                                },
                                2: {
                                    words: ['HOUSE', 'WATER', 'APPLE', 'HAPPY', 'GREEN', 'SMILE', 'CLOUD', 'FLOWER', 'MUSIC', 'PENCIL'],
                                    hints: [
                                        'Where people live',
                                        'You drink it',
                                        'Red fruit that keeps doctor away',
                                        'Opposite of sad',
                                        'Color of grass',
                                        'What you do when happy',
                                        'White and fluffy in the sky',
                                        'Grows in gardens',
                                        'Sounds that make songs',
                                        'You write with it'
                                    ]
                                },
                                3: {
                                    words: ['BUTTERFLY', 'ELEPHANT', 'MOUNTAIN', 'HOSPITAL', 'LIBRARY', 'CHRISTMAS', 'BIRTHDAY', 'FAMILY', 'TEACHER', 'WEATHER'],
                                    hints: [
                                        'Colorful insect with wings',
                                        'Large animal with a trunk',
                                        'Very high hill',
                                        'Where sick people go',
                                        'Where books are kept',
                                        'December holiday',
                                        'Celebration of getting older',
                                        'Parents and children',
                                        'Person who helps you learn',
                                        'Sunny, rainy, or snowy'
                                    ]
                                }
                            };
                            
                            let score = 0;
                            let level = 1;
                            let currentWordIndex = 0;
                            let currentLetters = [];
                            let wordsCompleted = 0;
                            const wordsPerLevel = 10;
                            let currentLevelData = spellingLevels[level];
                            
                            function updateScore(points) {
                                score += points;
                                document.getElementById('score').textContent = score;
                            }
                            
                            function updateProgress() {
                                const progress = (wordsCompleted / wordsPerLevel) * 100;
                                document.getElementById('progress-fill').style.width = \`\${progress}%\`;
                                document.getElementById('words-count').textContent = \`\${wordsCompleted}/\${wordsPerLevel}\`;
                            }
                            
                            function generateKeyboard() {
                                const keyboard = document.getElementById('keyboard');
                                keyboard.innerHTML = '';
                                
                                const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                                
                                for (let i = 0; i < alphabet.length; i++) {
                                    const letter = alphabet[i];
                                    const key = document.createElement('button');
                                    key.className = 'key';
                                    key.textContent = letter;
                                    key.onclick = () => addLetter(letter);
                                    keyboard.appendChild(key);
                                }
                                
                                // Add backspace key
                                const backspaceKey = document.createElement('button');
                                backspaceKey.className = 'key';
                                backspaceKey.innerHTML = '<i class="fas fa-backspace"></i>';
                                backspaceKey.onclick = removeLastLetter;
                                keyboard.appendChild(backspaceKey);
                                
                                // Add space key
                                const spaceKey = document.createElement('button');
                                spaceKey.className = 'key';
                                spaceKey.innerHTML = '<i class="fas fa-space-awesome"></i>';
                                spaceKey.onclick = () => addLetter(' ');
                                keyboard.appendChild(spaceKey);
                            }
                            
                            function loadSpellingWord() {
                                const word = currentLevelData.words[currentWordIndex];
                                document.getElementById('word-to-spell').textContent = word;
                                document.getElementById('spelling-area').textContent = '';
                                document.getElementById('feedback').textContent = '';
                                document.getElementById('hint').textContent = '';
                                document.getElementById('level').textContent = level;
                                currentLetters = [];
                            }
                            
                            function addLetter(letter) {
                                if (currentLetters.length < 15) {
                                    currentLetters.push(letter);
                                    document.getElementById('spelling-area').textContent = currentLetters.join('');
                                }
                            }
                            
                            function removeLastLetter() {
                                if (currentLetters.length > 0) {
                                    currentLetters.pop();
                                    document.getElementById('spelling-area').textContent = currentLetters.join('');
                                }
                            }
                            
                            function clearSpelling() {
                                currentLetters = [];
                                document.getElementById('spelling-area').textContent = '';
                                document.getElementById('feedback').textContent = '';
                            }
                            
                            function checkSpelling() {
                                const word = currentLevelData.words[currentWordIndex];
                                const userWord = currentLetters.join('').trim().toUpperCase();
                                const feedback = document.getElementById('feedback');
                                
                                if (userWord === word) {
                                    feedback.textContent = 'Excellent! Perfect spelling! ';
                                    feedback.className = 'feedback positive';
                                    
                                    let points = 20;
                                    if (level === 2) points = 30;
                                    if (level === 3) points = 40;
                                    
                                    updateScore(points);
                                    wordsCompleted++;
                                    updateProgress();
                                    
                                    // Check if level complete
                                    if (wordsCompleted >= wordsPerLevel) {
                                        setTimeout(() => {
                                            if (level < 3) {
                                                levelUp();
                                            } else {
                                                feedback.textContent = 'Congratulations! You completed all levels! ';
                                                updateScore(100); // Bonus for completing all levels
                                            }
                                        }, 1500);
                                    }
                                    
                                    setTimeout(nextWord, 2000);
                                } else {
                                    feedback.textContent = \`Try again! The word is "\${word}"\`;
                                    feedback.className = 'feedback negative';
                                }
                            }
                            
                            function getHint() {
                                const hint = currentLevelData.hints[currentWordIndex];
                                document.getElementById('hint').textContent = \`Hint: \${hint}\`;
                                updateScore(-5); // Deduct points for using hint
                            }
                            
                            function nextWord() {
                                currentWordIndex = (currentWordIndex + 1) % currentLevelData.words.length;
                                loadSpellingWord();
                            }
                            
                            function levelUp() {
                                level++;
                                if (level > 3) level = 3;
                                
                                currentLevelData = spellingLevels[level];
                                currentWordIndex = 0;
                                wordsCompleted = 0;
                                
                                const feedback = document.getElementById('feedback');
                                feedback.textContent = \`Level Up! Now playing Level \${level}\`;
                                feedback.className = 'feedback positive';
                                
                                updateProgress();
                                loadSpellingWord();
                                
                                // Add level up bonus
                                updateScore(50);
                            }
                            
                            // Initialize the game
                            generateKeyboard();
                            loadSpellingWord();
                            updateProgress();
                            
                            // Add touch event listeners for mobile
                            document.addEventListener('touchstart', function(e) {
                                if (e.target.classList.contains('key') || e.target.classList.contains('control-btn')) {
                                    e.preventDefault();
                                }
                            }, { passive: false });
                        <\/script>
                    </body>
                    </html>
                `;
            }
            
            createMathGameHTML() {
                return `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>Math Adventure</title>
                        <style>
                            body {
                                font-family: 'Arial', sans-serif;
                                background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
                                min-height: 100vh;
                                display: flex;
                                flex-direction: column;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                padding: 20px;
                                margin: 0;
                            }
                            
                            .game-container {
                                max-width: 800px;
                                width: 100%;
                                background: rgba(255, 255, 255, 0.1);
                                backdrop-filter: blur(10px);
                                border-radius: 20px;
                                padding: 30px;
                                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
                                border: 1px solid rgba(255, 255, 255, 0.2);
                                text-align: center;
                            }
                            
                            h1 {
                                font-size: 2.5rem;
                                margin-bottom: 10px;
                                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                            }
                            
                            .score {
                                font-size: 1.5rem;
                                margin: 20px 0;
                                color: #ffd166;
                            }
                            
                            .problem {
                                font-size: 3rem;
                                margin: 30px 0;
                                min-height: 80px;
                                font-weight: bold;
                            }
                            
                            .options {
                                display: grid;
                                grid-template-columns: repeat(2, 1fr);
                                gap: 20px;
                                margin-top: 20px;
                            }
                            
                            @media (max-width: 600px) {
                                .options {
                                    grid-template-columns: 1fr;
                                }
                            }
                            
                            .option {
                                background: rgba(255, 255, 255, 0.2);
                                border: none;
                                border-radius: 15px;
                                padding: 20px;
                                color: white;
                                font-size: 1.8rem;
                                cursor: pointer;
                                transition: all 0.3s;
                                font-weight: bold;
                            }
                            
                            .option:hover {
                                background: rgba(255, 255, 255, 0.3);
                                transform: translateY(-5px);
                            }
                            
                            .option.correct {
                                background: #06d6a0;
                                color: white;
                            }
                            
                            .option.incorrect {
                                background: #ef476f;
                                color: white;
                            }
                            
                            button {
                                background: #ffd166;
                                border: none;
                                border-radius: 15px;
                                padding: 15px 30px;
                                color: #333;
                                font-size: 1.2rem;
                                cursor: pointer;
                                transition: all 0.3s;
                                font-weight: bold;
                                margin: 10px;
                            }
                            
                            button:hover {
                                background: #ffc043;
                                transform: translateY(-3px);
                            }
                            
                            .feedback {
                                font-size: 1.5rem;
                                margin: 20px 0;
                                min-height: 40px;
                            }
                            
                            .positive {
                                color: #06d6a0;
                            }
                            
                            .negative {
                                color: #ef476f;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="game-container">
                            <h1>Math Adventure</h1>
                            <div class="score">Score: <span id="score">0</span></div>
                            
                            <div class="problem" id="problem">5 + 3 = ?</div>
                            
                            <div class="feedback" id="feedback"></div>
                            
                            <div class="options">
                                <button class="option" id="option1" onclick="checkAnswer(0)">8</button>
                                <button class="option" id="option2" onclick="checkAnswer(1)">7</button>
                                <button class="option" id="option3" onclick="checkAnswer(2)">9</button>
                                <button class="option" id="option4" onclick="checkAnswer(3)">6</button>
                            </div>
                            
                            <div style="margin-top: 30px;">
                                <button onclick="generateProblem()">Next Question</button>
                                <button onclick="resetGame()">Restart Game</button>
                            </div>
                        </div>
                        
                        <script>
                            let score = 0;
                            let currentProblem = { num1: 5, num2: 3, operator: '+', answer: 8 };
                            let options = [8, 7, 9, 6];
                            
                            function updateScore(points) {
                                score += points;
                                document.getElementById('score').textContent = score;
                            }
                            
                            function generateProblem() {
                                const operators = ['+', '-', '', ''];
                                const operator = operators[Math.floor(Math.random() * operators.length)];
                                let num1, num2, answer;
                                
                                switch(operator) {
                                    case '+':
                                        num1 = Math.floor(Math.random() * 20) + 1;
                                        num2 = Math.floor(Math.random() * 20) + 1;
                                        answer = num1 + num2;
                                        break;
                                    case '-':
                                        num1 = Math.floor(Math.random() * 20) + 10;
                                        num2 = Math.floor(Math.random() * 10) + 1;
                                        answer = num1 - num2;
                                        break;
                                    case '':
                                        num1 = Math.floor(Math.random() * 10) + 1;
                                        num2 = Math.floor(Math.random() * 10) + 1;
                                        answer = num1 * num2;
                                        break;
                                    case '':
                                        num2 = Math.floor(Math.random() * 5) + 2;
                                        answer = Math.floor(Math.random() * 5) + 2;
                                        num1 = num2 * answer;
                                        break;
                                }
                                
                                currentProblem = { num1, num2, operator, answer };
                                document.getElementById('problem').textContent = \`\${num1} \${operator} \${num2} = ?\`;
                                
                                // Generate answer options
                                options = [answer];
                                while (options.length < 4) {
                                    const wrongAnswer = answer + Math.floor(Math.random() * 10) - 5;
                                    if (wrongAnswer !== answer && wrongAnswer > 0 && !options.includes(wrongAnswer)) {
                                        options.push(wrongAnswer);
                                    }
                                }
                                
                                // Shuffle options
                                options.sort(() => Math.random() - 0.5);
                                
                                // Update buttons
                                for (let i = 1; i <= 4; i++) {
                                    const button = document.getElementById(\`option\${i}\`);
                                    button.textContent = options[i-1];
                                    button.className = 'option';
                                    button.disabled = false;
                                }
                                
                                document.getElementById('feedback').textContent = '';
                                document.getElementById('feedback').className = 'feedback';
                            }
                            
                            function checkAnswer(selectedIndex) {
                                const selectedAnswer = options[selectedIndex];
                                const feedback = document.getElementById('feedback');
                                
                                // Disable all buttons
                                for (let i = 1; i <= 4; i++) {
                                    document.getElementById(\`option\${i}\`).disabled = true;
                                }
                                
                                if (selectedAnswer === currentProblem.answer) {
                                    document.getElementById(\`option\${selectedIndex + 1}\`).classList.add('correct');
                                    feedback.textContent = 'Correct! ';
                                    feedback.className = 'feedback positive';
                                    updateScore(10);
                                } else {
                                    document.getElementById(\`option\${selectedIndex + 1}\`).classList.add('incorrect');
                                    feedback.textContent = \`Incorrect. The answer is \${currentProblem.answer}\`;
                                    feedback.className = 'feedback negative';
                                    
                                    // Highlight correct answer
                                    const correctIndex = options.indexOf(currentProblem.answer);
                                    document.getElementById(\`option\${correctIndex + 1}\`).classList.add('correct');
                                }
                            }
                            
                            function resetGame() {
                                score = 0;
                                updateScore(0);
                                generateProblem();
                            }
                            
                            // Initialize the game
                            generateProblem();
                        <\/script>
                    </body>
                    </html>
                `;
            }
            
            createWordGameHTML() {
                return `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>Word Explorer</title>
                        <style>
                            body {
                                font-family: 'Arial', sans-serif;
                                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                min-height: 100vh;
                                display: flex;
                                flex-direction: column;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                padding: 20px;
                                margin: 0;
                            }
                            
                            .game-container {
                                max-width: 800px;
                                width: 100%;
                                background: rgba(255, 255, 255, 0.1);
                                backdrop-filter: blur(10px);
                                border-radius: 20px;
                                padding: 30px;
                                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
                                border: 1px solid rgba(255, 255, 255, 0.2);
                                text-align: center;
                            }
                            
                            h1 {
                                font-size: 2.5rem;
                                margin-bottom: 10px;
                                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                            }
                            
                            .score {
                                font-size: 1.5rem;
                                margin: 20px 0;
                                color: #ffd166;
                            }
                            
                            .scrambled-word {
                                margin: 20px 0;
                            }
                            
                            input:focus {
                                outline: none;
                                border-color: #ffd166;
                            }
                            
                            button {
                                background: #ffd166;
                                border: none;
                                border-radius: 15px;
                                padding: 15px 30px;
                                color: #333;
                                font-size: 1.2rem;
                                cursor: pointer;
                                transition: all 0.3s;
                                font-weight: bold;
                                margin: 10px;
                            }
                            
                            button:hover {
                                background: #ffc043;
                                transform: translateY(-3px);
                            }
                            
                            .feedback {
                                font-size: 1.5rem;
                                margin: 20px 0;
                                min-height: 40px;
                            }
                            
                            .positive {
                                color: #06d6a0;
                            }
                            
                            .negative {
                                color: #ef476f;
                            }
                            
                            .hint {
                                color: #ffd166;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="game-container">
                            <h1>Word Explorer</h1>
                            <div class="score">Score: <span id="score">0</span></div>
                            
                            <div class="scrambled-word" id="scrambled-word">ELPPA</div>
                            
                            <input type="text" id="word-input" placeholder="Type the unscrambled word">
                            
                            <div>
                                <button onclick="checkWord()">Submit</button>
                                <button onclick="getHint()">Get Hint</button>
                                <button onclick="nextWord()">Skip</button>
                            </div>
                            
                            <div class="feedback" id="feedback"></div>
                        </div>
                        
                        <script>
                            const words = [
                                { scrambled: "ELPPA", word: "APPLE", hint: "A fruit that keeps the doctor away" },
                                { scrambled: "NABANAB", word: "BANANA", hint: "A yellow curved fruit" },
                                { scrambled: "RAGEON", word: "ORANGE", hint: "A citrus fruit and a color" },
                                { scrambled: "MTOATO", word: "TOMATO", hint: "Red fruit often used in salads" },
                                { scrambled: "RWOSTBERRY", word: "STRAWBERRY", hint: "Red berry with seeds on the outside" },
                                { scrambled: "NIPHEAPLP", word: "PINEAPPLE", hint: "Tropical fruit with spiky skin" },
                                { scrambled: "WTERMELONA", word: "WATERMELON", hint: "Large green fruit with red flesh" },
                                { scrambled: "NGRAPEES", word: "GRAPES", hint: "Small fruits that grow in bunches" },
                                { scrambled: "YECHERR", word: "CHERRY", hint: "Small red fruit with a pit" },
                                { scrambled: "EMOLN", word: "LEMON", hint: "Sour yellow citrus fruit" }
                            ];
                            
                            let score = 0;
                            let currentWordIndex = 0;
                            let hintsUsed = 0;
                            
                            function updateScore(points) {
                                score += points;
                                document.getElementById('score').textContent = score;
                            }
                            
                            function loadWord() {
                                const word = words[currentWordIndex];
                                document.getElementById('scrambled-word').textContent = word.scrambled;
                                document.getElementById('word-input').value = '';
                                document.getElementById('feedback').textContent = '';
                                document.getElementById('feedback').className = 'feedback';
                                hintsUsed = 0;
                            }
                            
                            function checkWord() {
                                const input = document.getElementById('word-input').value.toUpperCase().trim();
                                const word = words[currentWordIndex];
                                const feedback = document.getElementById('feedback');
                                
                                if (input === word.word) {
                                    feedback.textContent = 'Correct! ';
                                    feedback.className = 'feedback positive';
                                    
                                    let points = 10;
                                    if (hintsUsed > 0) {
                                        points = Math.max(5, 10 - hintsUsed * 2);
                                    }
                                    
                                    updateScore(points);
                                    
                                    setTimeout(() => {
                                        currentWordIndex = (currentWordIndex + 1) % words.length;
                                        loadWord();
                                    }, 1500);
                                } else {
                                    feedback.textContent = 'Try again!';
                                    feedback.className = 'feedback negative';
                                }
                            }
                            
                            function getHint() {
                                const word = words[currentWordIndex];
                                const feedback = document.getElementById('feedback');
                                feedback.textContent = \`Hint: \${word.hint}\`;
                                feedback.className = 'feedback hint';
                                hintsUsed++;
                                updateScore(-2);
                            }
                            
                            function nextWord() {
                                currentWordIndex = (currentWordIndex + 1) % words.length;
                                loadWord();
                                updateScore(-5);
                            }
                            
                            // Allow pressing Enter to submit
                            document.getElementById('word-input').addEventListener('keypress', function(e) {
                                if (e.key === 'Enter') {
                                    checkWord();
                                }
                            });
                            
                            // Initialize the game
                            loadWord();
                        <\/script>
                    </body>
                    </html>
                `;
            }
            
            createScienceGameHTML() {
                return `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>Science Quest</title>
                        <style>
                            body {
                                font-family: 'Arial', sans-serif;
                                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                                min-height: 100vh;
                                display: flex;
                                flex-direction: column;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                padding: 20px;
                                margin: 0;
                            }
                            
                            .game-container {
                                max-width: 800px;
                                width: 100%;
                                background: rgba(255, 255, 255, 0.1);
                                backdrop-filter: blur(10px);
                                border-radius: 20px;
                                padding: 30px;
                                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
                                border: 1px solid rgba(255, 255, 255, 0.2);
                                text-align: center;
                            }
                            
                            h1 {
                                font-size: 2.5rem;
                                margin-bottom: 10px;
                                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                            }
                            
                            .score {
                                font-size: 1.5rem;
                                margin: 20px 0;
                                color: #ffd166;
                            }
                            
                            .question {
                                font-size: 1.8rem;
                                margin: 30px 0;
                                min-height: 80px;
                                line-height: 1.5;
                            }
                            
                            .options {
                                display: flex;
                                flex-direction: column;
                                gap: 15px;
                                margin: 20px 0;
                            }
                            
                            .option {
                                background: rgba(255, 255, 255, 0.2);
                                border: none;
                                border-radius: 15px;
                                padding: 20px;
                                color: white;
                                font-size: 1.3rem;
                                cursor: pointer;
                                transition: all 0.3s;
                                text-align: left;
                            }
                            
                            .option:hover {
                                background: rgba(255, 255, 255, 0.3);
                                transform: translateY(-5px);
                            }
                            
                            .option.correct {
                                background: #06d6a0;
                                color: white;
                            }
                            
                            .option.incorrect {
                                background: #ef476f;
                                color: white;
                            }
                            
                            button {
                                background: #ffd166;
                                border: none;
                                border-radius: 15px;
                                padding: 15px 30px;
                                color: #333;
                                font-size: 1.2rem;
                                cursor: pointer;
                                transition: all 0.3s;
                                font-weight: bold;
                                margin: 10px;
                            }
                            
                            button:hover {
                                background: #ffc043;
                                transform: translateY(-3px);
                            }
                            
                            .feedback {
                                font-size: 1.5rem;
                                margin: 20px 0;
                                min-height: 40px;
                            }
                            
                            .positive {
                                color: #06d6a0;
                            }
                            
                            .negative {
                                color: #ef476f;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="game-container">
                            <h1>Science Quest</h1>
                            <div class="score">Score: <span id="score">0</span></div>
                            <div class="question-counter">Question: <span id="question-num">1</span>/10</div>
                            
                            <div class="question" id="question">What is the largest planet in our solar system?</div>
                            
                            <div class="options">
                                <button class="option" id="option1" onclick="checkAnswer(0)">Earth</button>
                                <button class="option" id="option2" onclick="checkAnswer(1)">Jupiter</button>
                                <button class="option" id="option3" onclick="checkAnswer(2)">Saturn</button>
                                <button class="option" id="option4" onclick="checkAnswer(3)">Mars</button>
                            </div>
                            
                            <div class="feedback" id="feedback"></div>
                            
                            <div>
                                <button onclick="nextQuestion()">Next Question</button>
                                <button onclick="resetQuiz()">Restart Quiz</button>
                            </div>
                        </div>
                        
                        <script>
                            const scienceQuestions = [
                                {
                                    question: "What is the largest planet in our solar system?",
                                    options: ["Earth", "Jupiter", "Saturn", "Mars"],
                                    answer: 1
                                },
                                {
                                    question: "What gas do plants absorb from the atmosphere?",
                                    options: ["Oxygen", "Carbon Dioxide", "Nitrogen", "Hydrogen"],
                                    answer: 1
                                },
                                {
                                    question: "What is the chemical symbol for gold?",
                                    options: ["Go", "Gd", "Au", "Ag"],
                                    answer: 2
                                },
                                {
                                    question: "What is the hardest natural substance on Earth?",
                                    options: ["Gold", "Iron", "Diamond", "Platinum"],
                                    answer: 2
                                },
                                {
                                    question: "How many bones are in the adult human body?",
                                    options: ["206", "150", "300", "106"],
                                    answer: 0
                                },
                                {
                                    question: "What is the fastest land animal?",
                                    options: ["Lion", "Cheetah", "Pronghorn Antelope", "Quarter Horse"],
                                    answer: 1
                                },
                                {
                                    question: "What planet is known as the Red Planet?",
                                    options: ["Venus", "Mars", "Jupiter", "Saturn"],
                                    answer: 1
                                },
                                {
                                    question: "What is the main gas found in the air we breathe?",
                                    options: ["Oxygen", "Carbon Dioxide", "Nitrogen", "Hydrogen"],
                                    answer: 2
                                },
                                {
                                    question: "How many elements are in the periodic table?",
                                    options: ["92", "118", "103", "87"],
                                    answer: 1
                                },
                                {
                                    question: "What is the largest organ in the human body?",
                                    options: ["Liver", "Brain", "Skin", "Lungs"],
                                    answer: 2
                                }
                            ];
                            
                            let score = 0;
                            let currentQuestionIndex = 0;
                            
                            function updateScore(points) {
                                score += points;
                                document.getElementById('score').textContent = score;
                            }
                            
                            function loadQuestion() {
                                const question = scienceQuestions[currentQuestionIndex];
                                document.getElementById('question').textContent = question.question;
                                document.getElementById('question-num').textContent = currentQuestionIndex + 1;
                                
                                for (let i = 1; i <= 4; i++) {
                                    const button = document.getElementById(\`option\${i}\`);
                                    button.textContent = question.options[i-1];
                                    button.className = 'option';
                                    button.disabled = false;
                                }
                                
                                document.getElementById('feedback').textContent = '';
                                document.getElementById('feedback').className = 'feedback';
                            }
                            
                            function checkAnswer(selectedIndex) {
                                const question = scienceQuestions[currentQuestionIndex];
                                const feedback = document.getElementById('feedback');
                                
                                // Disable all buttons
                                for (let i = 1; i <= 4; i++) {
                                    document.getElementById(\`option\${i}\`).disabled = true;
                                }
                                
                                if (selectedIndex === question.answer) {
                                    document.getElementById(\`option\${selectedIndex + 1}\`).classList.add('correct');
                                    feedback.textContent = 'Correct! ';
                                    feedback.className = 'feedback positive';
                                    updateScore(10);
                                } else {
                                    document.getElementById(\`option\${selectedIndex + 1}\`).classList.add('incorrect');
                                    feedback.textContent = \`Incorrect. The answer is \${question.options[question.answer]}\`;
                                    feedback.className = 'feedback negative';
                                    
                                    // Highlight correct answer
                                    document.getElementById(\`option\${question.answer + 1}\`).classList.add('correct');
                                }
                            }
                            
                            function nextQuestion() {
                                currentQuestionIndex = (currentQuestionIndex + 1) % scienceQuestions.length;
                                loadQuestion();
                            }
                            
                            function resetQuiz() {
                                score = 0;
                                currentQuestionIndex = 0;
                                updateScore(0);
                                loadQuestion();
                            }
                            
                            // Initialize the quiz
                            loadQuestion();
                        <\/script>
                    </body>
                    </html>
                `;
            }
            
            init() {
                // Set current year
                document.getElementById('currentYear').textContent = new Date().getFullYear();
                
                // Load initial data
                this.loadGames();
                this.updateStats();
                this.setupEventListeners();
                this.setupUploadHandler();
                
                // Show welcome message on first visit
                this.showWelcomeOnFirstVisit();
            }
            
            showWelcomeOnFirstVisit() {
                // Check if this is the first visit
                const hasVisited = localStorage.getItem('hasVisitedPlatform');
                if (!hasVisited) {
                    // Show welcome modal after a short delay
                    setTimeout(() => {
                        this.welcomeMessage.showWelcomeMessage();
                        localStorage.setItem('hasVisitedPlatform', 'true');
                    }, 1000);
                }
            }
            
            getSampleGameById(id) {
                return this.sampleGames.find(game => game.id === id);
            }
            
            loadGames() {
                const gamesGrid = document.getElementById('gamesGrid');
                const emptyState = document.getElementById('emptyState');
                
                // Get all games
                const storedGames = this.storage.getAllGames();
                const allGames = [...this.sampleGames, ...storedGames];
                
                // Filter games
                let filteredGames = allGames;
                
                if (this.currentFilter !== 'all') {
                    if (this.currentFilter === 'uploaded') {
                        // Only show user's uploaded games when logged in
                        const currentUser = this.authUI.getCurrentUser();
                        if (currentUser) {
                            filteredGames = this.storage.getUserGames(currentUser.id);
                        } else {
                            filteredGames = [];
                        }
                    } else {
                        filteredGames = allGames.filter(game => game.category === this.currentFilter);
                    }
                }
                
                if (this.currentSearch) {
                    const searchQuery = this.currentSearch.toLowerCase();
                    filteredGames = filteredGames.filter(game => 
                        game.title.toLowerCase().includes(searchQuery) ||
                        game.description.toLowerCase().includes(searchQuery) ||
                        game.category.toLowerCase().includes(searchQuery)
                    );
                }
                
                // Clear grid
                gamesGrid.innerHTML = '';
                
                // Show empty state if no games
                if (filteredGames.length === 0) {
                    emptyState.style.display = 'block';
                    gamesGrid.style.display = 'none';
                    return;
                }
                
                // Show grid
                emptyState.style.display = 'none';
                gamesGrid.style.display = 'grid';
                
                // Render games
                filteredGames.forEach(game => {
                    gamesGrid.appendChild(this.createGameCard(game));
                });
            }
            
            createGameCard(game) {
                const card = document.createElement('div');
                card.className = `game-card fade-in ${game.type === 'uploaded' ? 'uploaded' : ''}`;
                
                const colors = {
                    'math': ['#4a6fa5', '#6b8cbc'],
                    'science': ['#5cb85c', '#4cae4c'],
                    'language': ['#9b59b6', '#8e44ad'],
                    'coding': ['#2aa198', '#268bd2'],
                    'social': ['#d9534f', '#c9302c'],
                    'arts': ['#ff9e5d', '#ff8e42'],
                    'puzzle': ['#f0ad4e', '#ec971f'],
                    'other': ['#8e44ad', '#9b59b6']
                };
                
                const [color1, color2] = colors[game.category] || colors.other;
                const icons = {
                    'math': 'fas fa-calculator',
                    'science': 'fas fa-flask',
                    'language': 'fas fa-language',
                    'coding': 'fas fa-code',
                    'social': 'fas fa-globe-americas',
                    'arts': 'fas fa-palette',
                    'puzzle': 'fas fa-puzzle-piece',
                    'other': 'fas fa-mobile-alt'
                };
                
                card.innerHTML = `
                    <div class="game-image" style="background: linear-gradient(135deg, ${color1}, ${color2})">
                        <i class="${icons[game.category] || 'fas fa-gamepad'}"></i>
                        ${game.type === 'uploaded' ? '<span class="game-type-badge">Uploaded</span>' : ''}
                    </div>
                    <div class="game-info">
                        <h3>${game.title}</h3>
                        <div class="game-meta">
                            <span><i class="fas fa-tag"></i> ${this.formatCategory(game.category)}</span>
                            <span><i class="fas fa-user-graduate"></i> ${game.ageRange || 'All ages'}</span>
                            <span><i class="fas fa-play-circle"></i> ${game.playCount || 0}</span>
                        </div>
                        <p class="game-desc">${game.description}</p>
                        <div class="game-actions">
                            <button class="play-btn" data-game-id="${game.id}">
                                <i class="fas fa-play"></i> Play Game
                            </button>
                            ${game.type === 'uploaded' && this.canDeleteGame(game) ? `
                                <button class="delete-btn" data-game-id="${game.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                return card;
            }
            
            canDeleteGame(game) {
                const currentUser = this.authUI.getCurrentUser();
                return currentUser && game.userId === currentUser.id;
            }
            
            formatCategory(category) {
                const categories = {
                    'math': 'Mathematics',
                    'science': 'Science',
                    'language': 'Language Arts',
                    'coding': 'Programming',
                    'social': 'Social Studies',
                    'arts': 'Arts & Creativity',
                    'puzzle': 'Puzzle',
                    'other': 'Others'
                };
                return categories[category] || category;
            }
            
            updateStats() {
                const stats = this.storage.getStats();
                const samplePlays = this.sampleGames.reduce((sum, game) => sum + (game.playCount || 0), 0);
                
                document.getElementById('totalGames').textContent = stats.totalGames + this.sampleGames.length;
                document.getElementById('totalUploads').textContent = stats.totalUploads;
                document.getElementById('totalPlays').textContent = stats.totalPlays + samplePlays;
            }
            
            setupEventListeners() {
                // Filter buttons
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentFilter = e.target.dataset.filter;
                        this.loadGames();
                    });
                });
                
                // Search input
                document.getElementById('gameSearch').addEventListener('input', (e) => {
                    this.currentSearch = e.target.value.toLowerCase();
                    this.loadGames();
                });
                
                // Play and delete buttons (event delegation)
                document.getElementById('gamesGrid').addEventListener('click', (e) => {
                    const playBtn = e.target.closest('.play-btn');
                    const deleteBtn = e.target.closest('.delete-btn');
                    
                    if (playBtn) {
                        const gameId = parseInt(playBtn.dataset.gameId);
                        this.gamePlayer.playGame(gameId);
                    }
                    
                    if (deleteBtn) {
                        const gameId = parseInt(deleteBtn.dataset.gameId);
                        if (confirm('Are you sure you want to delete this game? This action cannot be undone.')) {
                            this.deleteGame(gameId);
                        }
                    }
                });
                
                // Navigation buttons
                document.getElementById('browseGamesBtn').addEventListener('click', () => {
                    document.querySelector('#library').scrollIntoView({ behavior: 'smooth' });
                });
                
                document.getElementById('uploadHeroBtn').addEventListener('click', () => {
                    document.querySelector('#upload').scrollIntoView({ behavior: 'smooth' });
                });
                
                // Mobile menu
                const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
                const navList = document.querySelector('.nav-list');
                
                mobileMenuBtn.addEventListener('click', () => {
                    const isExpanded = mobileMenuBtn.getAttribute('aria-expanded') === 'true';
                    mobileMenuBtn.setAttribute('aria-expanded', !isExpanded);
                    navList.classList.toggle('active');
                    
                    const icon = mobileMenuBtn.querySelector('i');
                    icon.className = navList.classList.contains('active') ? 'fas fa-times' : 'fas fa-bars';
                });
                
                // Close mobile menu when clicking links
                document.querySelectorAll('.nav-list a').forEach(link => {
                    link.addEventListener('click', () => {
                        mobileMenuBtn.setAttribute('aria-expanded', 'false');
                        navList.classList.remove('active');
                        mobileMenuBtn.querySelector('i').className = 'fas fa-bars';
                    });
                });
                
                // Close modal on ESC
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        if (document.getElementById('gameModal').classList.contains('active')) {
                            this.gamePlayer.closeGameModal();
                        }
                        if (document.getElementById('authModal').classList.contains('active')) {
                            this.authUI.closeAuthModal();
                        }
                        if (document.getElementById('welcomeModal').classList.contains('active')) {
                            this.welcomeMessage.closeWelcomeMessage();
                        }
                    }
                });
            }
            
            setupUploadHandler() {
                const uploadBox = document.getElementById('uploadBox');
                const fileInput = document.getElementById('fileInput');
                const saveBtn = document.getElementById('saveGameBtn');
                const cancelBtn = document.getElementById('cancelUploadBtn');
                
                // Click to select files
                uploadBox.addEventListener('click', () => {
                    const currentUser = this.authUI.getCurrentUser();
                    if (!currentUser) {
                        this.authUI.openAuthModal(true);
                        this.showNotification('Please login to upload games', 'warning');
                        return;
                    }
                    fileInput.click();
                });
                
                uploadBox.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        const currentUser = this.authUI.getCurrentUser();
                        if (!currentUser) {
                            this.authUI.openAuthModal(true);
                            this.showNotification('Please login to upload games', 'warning');
                            return;
                        }
                        fileInput.click();
                    }
                });
                
                // Drag and drop improvements
                uploadBox.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadBox.classList.add('dragover');
                });
                
                uploadBox.addEventListener('dragleave', () => {
                    uploadBox.classList.remove('dragover');
                });
                
                uploadBox.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadBox.classList.remove('dragover');
                    
                    const currentUser = this.authUI.getCurrentUser();
                    if (!currentUser) {
                        this.authUI.openAuthModal(true);
                        this.showNotification('Please login to upload games', 'warning');
                        return;
                    }
                    
                    if (e.dataTransfer.files.length > 0) {
                        fileInput.files = e.dataTransfer.files;
                        const event = new Event('change', { bubbles: true });
                        fileInput.dispatchEvent(event);
                    }
                });
                
                // File input change
                fileInput.addEventListener('change', async (e) => {
                    const currentUser = this.authUI.getCurrentUser();
                    if (!currentUser) {
                        this.authUI.openAuthModal(true);
                        this.showNotification('Please login to upload games', 'warning');
                        return;
                    }
                    
                    try {
                        const files = Array.from(e.target.files);
                        if (files.length === 0) return;
                        
                        // Show upload details
                        document.getElementById('uploadDetails').style.display = 'block';
                        
                        // Update file list
                        const fileList = document.getElementById('fileList');
                        const mainFileSelect = document.getElementById('mainFile');
                        
                        fileList.innerHTML = '';
                        mainFileSelect.innerHTML = '<option value="">Select main HTML file</option>';
                        
                        let totalSize = 0;
                        
                        for (let i = 0; i < files.length; i++) {
                            const file = files[i];
                            totalSize += file.size;
                            
                            // Add to file list
                            const li = document.createElement('li');
                            li.innerHTML = `
                                <div class="file-info">
                                    <i class="fas fa-file${this.getFileIcon(file.name)}"></i>
                                    <span>${file.name}</span>
                                </div>
                                <span class="file-size">${this.formatFileSize(file.size)}</span>
                            `;
                            fileList.appendChild(li);
                            
                            // Add HTML files to main file selector
                            if (file.name.toLowerCase().endsWith('.html') || file.name.toLowerCase().endsWith('.htm')) {
                                const option = document.createElement('option');
                                option.value = file.name;
                                option.textContent = file.name;
                                mainFileSelect.appendChild(option);
                            }
                        }
                        
                        // Auto-fill game title from first HTML file
                        const firstHtmlFile = files.find(f => f.name.toLowerCase().endsWith('.html') || f.name.toLowerCase().endsWith('.htm'));
                        if (firstHtmlFile) {
                            const title = firstHtmlFile.name.replace(/\.(html|htm)$/i, '').replace(/[_-]/g, ' ');
                            document.getElementById('gameTitle').value = this.capitalizeWords(title);
                        }
                        
                        // Auto-select category based on game title
                        const titleInput = document.getElementById('gameTitle');
                        const title = titleInput.value.toLowerCase();
                        if (title.includes('math') || title.includes('calculat')) {
                            document.getElementById('gameCategory').value = 'math';
                        } else if (title.includes('scien') || title.includes('chem') || title.includes('physic') || title.includes('bio')) {
                            document.getElementById('gameCategory').value = 'science';
                        } else if (title.includes('word') || title.includes('vocab') || title.includes('language')) {
                            document.getElementById('gameCategory').value = 'language';
                        } else if (title.includes('code') || title.includes('program')) {
                            document.getElementById('gameCategory').value = 'coding';
                        } else if (title.includes('spell') || title.includes('mobile')) {
                            document.getElementById('gameCategory').value = 'other';
                        }
                        
                        // Update progress (simulated)
                        const progressFill = document.getElementById('progressFill');
                        const progressText = document.getElementById('progressText');
                        const uploadProgress = document.getElementById('uploadProgress');
                        
                        uploadProgress.style.display = 'block';
                        
                        for (let i = 0; i <= 100; i += 10) {
                            await new Promise(resolve => setTimeout(resolve, 50));
                            progressFill.style.width = `${i}%`;
                            progressText.textContent = `Processing... ${i}%`;
                        }
                        
                        setTimeout(() => {
                            uploadProgress.style.display = 'none';
                            progressFill.style.width = '0%';
                            this.showNotification(`Loaded ${files.length} file(s) successfully`, 'success');
                        }, 500);
                        
                    } catch (error) {
                        this.showNotification(`Error loading files: ${error.message}`, 'error');
                    }
                });
                
                // Save game button
                saveBtn.addEventListener('click', async () => {
                    const currentUser = this.authUI.getCurrentUser();
                    if (!currentUser) {
                        this.authUI.openAuthModal(true);
                        this.showNotification('Please login to upload games', 'warning');
                        return;
                    }
                    
                    try {
                        const title = document.getElementById('gameTitle').value.trim();
                        const category = document.getElementById('gameCategory').value;
                        const description = document.getElementById('gameDescription').value.trim();
                        const ageRange = document.getElementById('gameAge').value.trim() || 'All ages';
                        const mainFile = document.getElementById('mainFile').value;
                        const files = fileInput.files;
                        
                        // Validation
                        if (!title || !category || !description || !mainFile || files.length === 0) {
                            throw new Error('Please fill in all required fields and select files');
                        }
                        
                        // Validate age range format
                        if (ageRange && !/^(\d+\+|\d+-\d+|All ages)$/.test(ageRange)) {
                            throw new Error('Age range should be in format like "8+", "12-16", or "All ages"');
                        }
                        
                        // Process files
                        const uploadHandler = new GameUploadHandler();
                        const processedFiles = await uploadHandler.processFiles(files);
                        
                        // Create game data
                        const gameData = {
                            title,
                            category,
                            description,
                            ageRange,
                            mainFile,
                            files: processedFiles.files,
                            totalSize: processedFiles.totalSize,
                            userId: currentUser.id
                        };
                        
                        // Save game
                        const savedGame = this.storage.saveGame(gameData);
                        
                        // Reset form
                        this.resetUploadForm();
                        
                        // Show success message
                        this.showNotification(`"${savedGame.title}" uploaded successfully!`, 'success');
                        
                        // Reload games
                        this.loadGames();
                        this.updateStats();
                        
                        // Scroll to library to show the new game
                        document.querySelector('#library').scrollIntoView({ behavior: 'smooth' });
                        
                    } catch (error) {
                        this.showNotification(`Upload failed: ${error.message}`, 'error');
                    }
                });
                
                // Cancel upload button
                cancelBtn.addEventListener('click', () => {
                    this.resetUploadForm();
                    this.showNotification('Upload cancelled', 'warning');
                });
            }
            
            resetUploadForm() {
                document.getElementById('fileInput').value = '';
                document.getElementById('uploadDetails').style.display = 'none';
                document.getElementById('gameTitle').value = '';
                document.getElementById('gameCategory').value = '';
                document.getElementById('gameDescription').value = '';
                document.getElementById('gameAge').value = '';
                document.getElementById('mainFile').innerHTML = '<option value="">Select main HTML file</option>';
                document.getElementById('fileList').innerHTML = '';
                document.getElementById('uploadProgress').style.display = 'none';
                document.getElementById('progressFill').style.width = '0%';
            }
            
            getFileIcon(filename) {
                if (filename.toLowerCase().endsWith('.html') || filename.toLowerCase().endsWith('.htm')) return '-code';
                if (filename.toLowerCase().endsWith('.js')) return '-code';
                if (filename.toLowerCase().endsWith('.css')) return '-code';
                if (filename.toLowerCase().endsWith('.png') || filename.toLowerCase().endsWith('.jpg') || filename.toLowerCase().endsWith('.jpeg')) return '-image';
                if (filename.toLowerCase().endsWith('.gif')) return '-image';
                return '';
            }
            
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            capitalizeWords(str) {
                return str.replace(/\b\w/g, char => char.toUpperCase());
            }
            
            deleteGame(gameId) {
                if (this.storage.deleteGame(gameId)) {
                    this.showNotification('Game deleted successfully', 'success');
                    this.loadGames();
                    this.updateStats();
                } else {
                    this.showNotification('Failed to delete game', 'error');
                }
            }
            
            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type} show`;
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        }

        // ============================
        // GLOBAL FUNCTIONS FOR BUTTONS
        // ============================
        function openMobileSpellingGame() {
            const modal = document.getElementById('gameModal');
            const loader = document.getElementById('modalLoader');
            const iframe = document.getElementById('gameFrame');
            const title = document.getElementById('modalGameTitle');
            
            title.textContent = 'Mobile Spelling Game';
            modal.classList.add('active');
            loader.style.display = 'flex';
            iframe.style.display = 'none';
            
            // Prevent body scrolling
            document.body.style.overflow = 'hidden';
            
            // Focus close button for accessibility
            setTimeout(() => {
                document.querySelector('.close-modal').focus();
            }, 100);
            
            // Load the mobile.spelling.html file
            iframe.src = 'mobile.spelling.html';
            
            // Handle load complete
            iframe.onload = () => {
                setTimeout(() => {
                    loader.style.display = 'none';
                    iframe.style.display = 'block';
                }, 300);
            };
            
            // Handle errors
            iframe.onerror = () => {
                loader.innerHTML = `
                    <div style="text-align: center; color: var(--danger);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <h3>Error Loading Game</h3>
                        <p>The mobile.spelling.html file could not be found. Please make sure the file exists in the same directory.</p>
                        <p>You can create this file or upload it using the upload section.</p>
                        <button class="btn btn-primary" onclick="closeGameModal()" style="margin-top: 1rem;">
                            Close
                        </button>
                    </div>
                `;
            };
        }

        // ============================
        // INITIALIZE APPLICATION
        // ============================
        const platform = new GamePlatform();
        const gamePlayer = new GamePlayer();
        
        // Make functions globally accessible
        window.gamePlayer = gamePlayer;
        window.openMobileSpellingGame = openMobileSpellingGame;
        window.closeGameModal = closeGameModal;
        window.scrollToUpload = scrollToUpload;
        
        document.addEventListener('DOMContentLoaded', () => {
            platform.init();
        });
        
        // Global functions for inline event handlers
        function scrollToUpload() {
            document.querySelector('#upload').scrollIntoView({ behavior: 'smooth' });
        }
        
        function closeGameModal() {
            gamePlayer.closeGameModal();
        }
    </script>
</body>
</html>                              
